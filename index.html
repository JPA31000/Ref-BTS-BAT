<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Référentiel BTS Bâtiment - Formulaire interactif</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Instrument Sans', sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); }
        ::-webkit-scrollbar-thumb { background: rgba(251, 191, 36, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(251, 191, 36, 0.5); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useMemo } = React;


// Logo Lycée Urbain Vitry (auteur de l'application)
const LOGO_LYCEE_URBAIN_VITRY = 'data:image/png;base64,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';

// Liste des ressources documentaires selon le référentiel BTS Bâtiment
const ressourcesDocumentaires = {
  "0. Identification du projet": [
    "Nom du projet",
    "Nom MOA",
    "Nom MOE",
    "Architecte",
    "Bureau d'étude structure",
    "Bureau de contrôle",
    "SPS",
    "Acousticien",
    "Bureau d'étude thermique"
  ],
  "1. Documents du dossier marché (DCE)": {
    "Pièces Écrites": [
      "CCTP",
      "CCAP",
      "CCAG",
      "RICT",
      "PGC",
      "Rapports d'études de sols"
    ],
    "Pièces Graphiques": [
      "Plan PRO ARC",
      "Plan PRO ST",
      "Plan PRO CVC",
      "Plans de prévention",
      "Plans de circulation"
    ],
    "Pièces Temporelles": [
      "Planning prévisionnel"
    ]
  },
  "2. Documents d'exécution et techniques": [
    "Dossier d'exécution",
    "Plans de coffrage",
    "Plans de ferraillage",
    "Plans de pose",
    "Croquis et schémas techniques",
    "Notes de calculs",
    "Fiches techniques",
    "Maquette numérique (BIM)"
  ],
  "3. Documents de gestion, organisation et suivi": [
    "Planning d'exécution détaillé",
    "PIC",
    "Budget prévisionnel",
    "Budget travaux",
    "Modes opératoires",
    "Comptes rendus de réunions de chantier",
    "Situations de travaux"
  ],
  "4. Documents administratifs et réglementaires": [
    "DICT",
    "Autorisations administratives",
    "Normes",
    "DTU",
    "Réglementations",
    "Certifications"
  ]
};

const connaissancesGlobales = [
  { id: 1, nom: "Projet de construction et cadre réglementaire", competences: ["C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "C14", "C15"] },
  { id: 2, nom: "Construction durable", competences: ["C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "C14", "C15"] },
  { id: 3, nom: "Environnement numérique d'un projet", competences: ["C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "C14", "C15"] },
  { id: 4, nom: "Sciences de la construction", competences: ["C1", "C2", "C4", "C15"] },
  { id: 5, nom: "Ouvrages et procédés de réalisation", competences: ["C1", "C2", "C4", "C7", "C9"] },
  { id: 6, nom: "Management et communication", competences: ["C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "C14", "C15"] },
  { id: 7, nom: "Santé et sécurité au travail", competences: ["C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C11", "C12", "C13", "C14", "C15"] },
  { id: 8, nom: "Préparation et organisation de chantier", competences: ["C6", "C7", "C8", "C9", "C10", "C11"] },
  { id: 9, nom: "Économie de la construction", competences: ["C3", "C8", "C10", "C11"] },
  { id: 10, nom: "Implantations - Contrôles", competences: ["C14"] },
  { id: 11, nom: "Démarche qualité", competences: ["C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C11", "C13", "C14", "C15"] }
];

const data = {
  blocs: [
    {
      id: 1,
      nom: "Analyse et proposition de solutions techniques",
      unite: "U5",
      poles: [
        {
          id: "A1.1",
          nom: "Analyse et choix d'une solution technique",
          conditionsExercice: {
            moyens: [
              "Extraits du dossier marché (CCTP, plans d'architecte, études de sols, PGC, plan de prévention, plan de circulation…)",
              "Extraits du dossier d'exécution",
              "Données du site (bâtiment neuf ou existant)",
              "Réglementations, normes, certifications en vigueur",
              "Environnement professionnel de l'entreprise (matériel, QSE, RSE, bases de données)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T1.1": [
              "Le besoin du client est analysé et explicité",
              "Les contraintes et les exigences du projet sont identifiées",
              "Les besoins et impossibilités techniques sont explicités"
            ],
            "T1.2": [
              "La solution technique est analysée",
              "Les points forts et les points de vigilance sont identifiés",
              "Les solutions sont comparées et un choix est opéré"
            ]
          },
          taches: [
            { id: "T1.1", nom: "Explicitation d'un besoin et formalisation de tout ou partie d'un cahier des charges", competences: ["C1"] },
            { id: "T1.2", nom: "Analyse et choix d'une solution technique", competences: ["C1"] }
          ]
        },
        {
          id: "A1.2",
          nom: "Proposition d'une solution technico-économique",
          conditionsExercice: {
            moyens: [
              "Extraits du dossier marché (CCTP, plans d'architecte, études de sols, PGC, plan de prévention…)",
              "Extraits du dossier d'exécution",
              "Données du site (bâtiment neuf ou existant)",
              "Réglementations, normes, certifications en vigueur",
              "Environnement professionnel de l'entreprise (matériel, QSE, RSE, bases de données)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T1.3": [
              "La solution technique est détaillée (choix des matériaux, méthodes, interfaces…) et argumentée",
              "La solution technique est décrite graphiquement",
              "La solution technique respecte les exigences réglementaires et du cahier des charges (mécanique, thermique, acoustique, impact carbone)"
            ],
            "T1.4": [
              "Les charges mécaniques sont décrites et estimées",
              "Un modèle mécanique est proposé",
              "Un calcul de dimensionnement manuel est réalisé",
              "Éléments limités à : élingues, étais, semelles de fondation, poutres isostatiques, poutres continues sans calcul hyperstatique, éléments en porte à faux, fixations, poteaux"
            ],
            "T1.5": [
              "Des détails constructifs sont élaborés : principes de ferraillage, interfaces, assemblages, composition des parois, croquis d'étaiement, positionnement des élingues",
              "Des coupes ou des vues nécessaires à la définition d'une solution technique sont réalisées",
              "Des schémas précisant les principes de réalisation en sécurité sont proposés"
            ],
            "T1.6": [
              "Un quantitatif est réalisé sur une partie de l'ouvrage",
              "Un prix de vente est proposé sur une partie de l'ouvrage",
              "La proposition technique et commerciale est réalisée"
            ]
          },
          taches: [
            { id: "T1.3", nom: "Proposition d'une solution technique", competences: ["C2"] },
            { id: "T1.4", nom: "Dimensionnement manuel des éléments structurels courants", competences: ["C2"] },
            { id: "T1.5", nom: "Réalisation de croquis et de schémas", competences: ["C2"] },
            { id: "T1.6", nom: "Rédaction d'une proposition commerciale pour une variante ou des travaux supplémentaires", competences: ["C3"] }
          ]
        }
      ],
      competences: [
        {
          id: "C1",
          nom: "Analyser un cahier des charges, un contexte, des solutions techniques",
          connaissances: [
            { nom: "Sciences de la construction", niveau: 4 },
            { nom: "Ouvrages et procédés de réalisation", niveau: 4 }
          ],
          criteres: [
            "Le cahier des charges est analysé et explicité par une synthèse",
            "Les points de vigilance sont identifiés et explicités : besoins, exigences, contraintes, incohérences éventuelles, impossibilités techniques",
            "Des solutions techniques sont analysées et/ou comparées selon plusieurs critères : technologie, mise en œuvre, coût, impact environnemental, sécurité",
            "Un choix technique est réalisé et justifié"
          ],
          taches: ["T1.1", "T1.2"]
        },
        {
          id: "C2",
          nom: "Proposer une solution technique pour le projet, pour une variante ou des travaux supplémentaires",
          connaissances: [
            { nom: "Sciences de la construction", niveau: 4 },
            { nom: "Ouvrages et procédés de réalisation", niveau: 4 }
          ],
          criteres: [
            "Les charges mécaniques sont décrites et estimées pour un ouvrage élémentaire courant de structure en béton armé, en bois ou en acier",
            "Un modèle mécanique est proposé",
            "Un calcul de dimensionnement manuel est réalisé (semelles, poutres isostatiques, poutres continues, porte à faux, fixations, poteaux)",
            "Un équipement de chantier ou de réalisation est dimensionné ou vérifié : étaiement, plateforme de sécurité, coffrage, garde-corps, apparaux de levage",
            "La solution technique est proposée et justifiée par rapport aux exigences réglementaires et au cahier des charges",
            "La solution technique est représentée sous forme de croquis ou de schémas"
          ],
          taches: ["T1.3", "T1.4", "T1.5"]
        },
        {
          id: "C3",
          nom: "Estimer économiquement une étude d'avant-projet",
          connaissances: [
            { nom: "Économie de la construction", niveau: 4 }
          ],
          criteres: [
            "Le quantitatif d'une partie d'ouvrage est établi",
            "Le prix de vente d'une partie d'ouvrage est établi à partir de données fournies",
            "La proposition technique et commerciale est finalisée"
          ],
          taches: ["T1.6"]
        }
      ]
    },
    {
      id: 2,
      nom: "Étude et préparation de chantier",
      unite: "U6",
      poles: [
        {
          id: "A2.1",
          nom: "Analyse et étude d'un projet",
          conditionsExercice: {
            moyens: [
              "Dossier marché (CCTP, plans d'architecte, études de sols, PGC, plan de prévention, plan de circulation)",
              "Dossier d'exécution",
              "Données du site (bâtiment neuf ou existant)",
              "Base de données entreprise (temps unitaires, cadences)",
              "Réglementations, normes, certifications en vigueur",
              "Démarche QSE de l'entreprise",
              "Démarche RSE de l'entreprise si elle existe (démarche bas carbone)",
              "Environnement professionnel de l'entreprise (progiciels, matériel, outils numériques)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T2.1": [
              "Une synthèse globale justifiée et structurée est rédigée en prenant en compte : les besoins, les exigences, les contraintes, les incohérences éventuelles, les impossibilités techniques"
            ],
            "T2.2": [
              "Les plans de structure sont produits",
              "Les éléments porteurs et leurs impacts sont identifiés",
              "Les incohérences éventuelles sont relevées",
              "Des solutions simples et adaptées sont proposées",
              "Des plans d'exécution sont réalisés"
            ],
            "T2.3": [
              "Le PGCSPS est analysé s'il existe",
              "Le PPSPS est complété par le PIC, les modes opératoires…",
              "Les risques sont identifiés et évalués",
              "Les moyens de prévention sont choisis en fonction de cette évaluation et des principes généraux de prévention"
            ],
            "T2.4": [
              "Les risques environnementaux sont anticipés",
              "Les acteurs sont identifiés",
              "Les documents réglementaires et normatifs sont connus et complétés",
              "Les méthodes de gestion des déchets sont mises en place",
              "L'impact environnemental est optimisé"
            ],
            "T2.5": [
              "Le CCTP est analysé en identifiant les exigences de qualité",
              "Les points singuliers et les interfaces sur chantier sont identifiés"
            ]
          },
          taches: [
            { id: "T2.1", nom: "Analyse globale du projet", competences: ["C4"] },
            { id: "T2.2", nom: "Analyse du fonctionnement mécanique d'un bâtiment neuf ou existant", competences: ["C4"] },
            { id: "T2.3", nom: "Analyse des risques pour la santé et la sécurité", competences: ["C5"] },
            { id: "T2.4", nom: "Analyse des exigences environnementales", competences: ["C5"] },
            { id: "T2.5", nom: "Analyse des exigences de qualité", competences: ["C5"] }
          ]
        },
        {
          id: "A2.2",
          nom: "Préparation de chantier",
          conditionsExercice: {
            moyens: [
              "Dossier marché (CCTP, plans d'architecte, études de sols, PGC, plan de prévention, plan de circulation)",
              "Dossier d'exécution",
              "Données du site",
              "Base de données entreprise (temps unitaires, cadences, coûts)",
              "Réglementations, normes, certifications en vigueur",
              "Démarche QSE de l'entreprise",
              "Démarche RSE de l'entreprise si elle existe",
              "Environnement professionnel de l'entreprise (progiciels, matériel, outils numériques)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T2.6": [
              "Les services compétents (DREETS, CARSAT, OPPBTP…) sont informés de l'ouverture du chantier",
              "À partir de la déclaration de travaux, les DICT sont demandées, étudiées et exploitées",
              "Les autorisations nécessaires (voirie, survol, engins de levage…) sont demandées aux services compétents"
            ],
            "T2.7": [
              "Le planning de chantier objectif est réalisé à partir du planning client (ajout d'une marge de sécurité)",
              "Les modes constructifs possibles sont comparés et le choix est justifié en fonction des contraintes techniques, économiques, environnementales et de prévention",
              "Un tableau de synthèse est réalisé"
            ],
            "T2.8": [
              "Les équipes sont définies",
              "Le type et la quantité de matériel sont définis et optimisés",
              "La charge de grue est réalisée et est cohérente",
              "Le type et la quantité de matériaux sont définis et optimisés",
              "Le mode de fabrication du béton est choisi"
            ],
            "T2.9": [
              "Les ouvrages élémentaires sont décomposés et quantifiés",
              "Le planning réalisé fait apparaître : la décomposition des tâches, l'enclenchement des tâches, la durée des tâches, les cadences",
              "Les jours non travaillés (congés, jours fériés, jours prévus pour intempéries) sont intégrés",
              "Les principales phases de logistique (livraisons…), les dates-jalons, le phasage si besoin sont définis",
              "La courbe de main d'œuvre est établie"
            ],
            "T2.10": [
              "Le cyclage des verticaux et des horizontaux est réalisé",
              "La rotation du matériel (coffrage et sécurité) est réalisable, cohérente voire optimisée",
              "Le calepinage des éléments préfabriqués est défini"
            ],
            "T2.11": [
              "Le plan d'installation de chantier est réalisé et mis à jour selon l'avancement du chantier",
              "Les moyens relatifs aux exigences de qualité, de prévention et environnementales sont définis",
              "Les engins de levage sont choisis, dimensionnés et positionnés en intégrant les phases de montage et de démontage",
              "Les zones de stockage sont définies",
              "La base vie, les accès, les circulations piétons et engins, les clôtures, les réseaux, les zones de stockage des déchets, les zones de terrassement, la zone d'approvisionnement sont définis"
            ],
            "T2.12": [
              "Les risques sont identifiés et évalués",
              "Les moyens de prévention sont choisis en fonction de cette évaluation",
              "Les points singuliers et les interfaces sur chantier sont identifiés",
              "Le matériel est choisi et adapté",
              "Les méthodes d'exécution sont définies"
            ],
            "T2.13": [
              "Les éléments suivants sont budgétés dans le cadre d'un déboursé sec d'un ouvrage élémentaire : main d'œuvre, matériaux, matériels, sous-traitants",
              "Les frais de chantier sont évalués",
              "Pour budgéter les matériaux et le matériel, les fournisseurs sont consultés"
            ]
          },
          taches: [
            { id: "T2.6", nom: "Recensement des démarches préalables à l'ouverture de chantier", competences: ["C6"] },
            { id: "T2.7", nom: "Définition des modes constructifs dans le cadre d'un planning objectif", competences: ["C7"] },
            { id: "T2.8", nom: "Choix et définition des moyens de réalisation à partir du planning objectif", competences: ["C7"] },
            { id: "T2.9", nom: "Élaboration d'un planning d'exécution détaillé", competences: ["C8"] },
            { id: "T2.10", nom: "Élaboration de cycles de travaux en cohérence avec le planning d'exécution détaillé", competences: ["C9"] },
            { id: "T2.11", nom: "Élaboration du plan d'installation de chantier", competences: ["C9"] },
            { id: "T2.12", nom: "Conception des modes opératoires sur chantier incluant la démarche QSE", competences: ["C9"] },
            { id: "T2.13", nom: "Élaboration d'un budget travaux", competences: ["C10"] }
          ]
        }
      ],
      competences: [
        {
          id: "C4",
          nom: "Analyser et finaliser la structure en fonction des choix constructifs",
          connaissances: [
            { nom: "Sciences de la construction", niveau: 4 },
            { nom: "Ouvrages et procédés de réalisation", niveau: 4 }
          ],
          criteres: [
            "Les éléments nécessaires à l'étude et à la préparation de chantier sont identifiés dans un dossier marché et explicités dans une note de synthèse",
            "Le fonctionnement de la structure porteuse d'un bâtiment est analysé : plans d'avant-projet structure, éléments porteurs, schéma de cheminement des charges",
            "Des hypothèses de chargement sont formulées et justifiées, des solutions simples et adaptées sont proposées",
            "Une descente de charges est réalisée avec un outil informatique et contrôlée sur un élément isolé",
            "Des plans d'exécution sont réalisés avec des progiciels 2D ou 3D, les normes de dessins sont respectées",
            "La maquette BIM « structure » d'une partie de l'ouvrage est finalisée"
          ],
          taches: ["T2.1", "T2.2"]
        },
        {
          id: "C5",
          nom: "Analyser et définir les moyens relatifs aux exigences de qualité, de prévention et d'environnement",
          connaissances: [
            { nom: "Connaissances transversales", niveau: 4 }
          ],
          criteres: [
            "Les enjeux et procédures liés à la prévention des risques sont analysés : PGC, PPSPS, risques identifiés et évalués, moyens de prévention choisis",
            "Le travail en hauteur est pris en compte",
            "Les enjeux et procédures liés à l'impact environnemental sont analysés : risques anticipés, documents réglementaires, gestion des déchets",
            "Les enjeux et procédures liés à la qualité sont analysés : CCTP, exigences de qualité, sur-exigences et impossibilités identifiées"
          ],
          taches: ["T2.3", "T2.4", "T2.5"]
        },
        {
          id: "C6",
          nom: "Réaliser les démarches nécessaires à l'ouverture du chantier",
          connaissances: [
            { nom: "Préparation et organisation de chantier", niveau: 4 }
          ],
          criteres: [
            "Les services compétents (DREETS, CARSAT, OPPBTP…) sont informés de l'ouverture du chantier",
            "Les éléments nécessaires à la DICT sont préparés sur un document",
            "L'Intervention à Proximité des Réseaux est analysée",
            "Les autorisations nécessaires (voirie, survol, engins de levage…) sont complétées"
          ],
          taches: ["T2.6"]
        },
        {
          id: "C7",
          nom: "Choisir et définir les moyens nécessaires à l'organisation du chantier",
          connaissances: [
            { nom: "Préparation et organisation de chantier", niveau: 4 },
            { nom: "Ouvrages et procédés de réalisation", niveau: 4 },
            { nom: "Économie de la construction", niveau: 4 }
          ],
          criteres: [
            "Le délai d'exécution objectif est défini à partir du délai client en incluant les marges et aléas",
            "Les modes constructifs possibles sont comparés, le choix est justifié et un tableau de synthèse est réalisé",
            "Le choix de la cinématique de réalisation permet de valider le planning objectif",
            "Les crédits d'heures sont calculés et les équipes sont définies",
            "Le type et la quantité de matériel, matériaux et consommables sont définis et optimisés"
          ],
          taches: ["T2.7", "T2.8"]
        },
        {
          id: "C8",
          nom: "Réaliser le planning d'exécution détaillé",
          connaissances: [
            { nom: "Préparation et organisation de chantier", niveau: 4 }
          ],
          criteres: [
            "Les ouvrages élémentaires sont décomposés et quantifiés",
            "Le planning d'exécution détaillé fait apparaître : décomposition et enclenchement des tâches, durées, cadences, jours non travaillés",
            "Les principales phases logistiques, dates-jalons et phasage sont intégrés",
            "La courbe de main d'œuvre est établie"
          ],
          taches: ["T2.9"]
        },
        {
          id: "C9",
          nom: "Élaborer les processus de réalisation détaillés et les modes opératoires",
          connaissances: [
            { nom: "Préparation et organisation de chantier", niveau: 4 },
            { nom: "Ouvrages et procédés de réalisation", niveau: 4 }
          ],
          criteres: [
            "Le plan d'installation de chantier est réalisé en plan et en coupe : emprise, engins de levage, base vie, clôtures, réseaux, zones de stockage",
            "Le mode de fabrication du béton est choisi",
            "Des modes opératoires sur chantier sont élaborés : décomposition chronologique, procédés d'exécution, matériels, risques évalués, moyens de prévention",
            "Des rotations de matériels et de poses des éléments industriels sont réalisées : cyclage, rotation du matériel, calepinage",
            "L'interface avec les autres corps d'états est traitée, les points singuliers sont analysés"
          ],
          taches: ["T2.10", "T2.11", "T2.12"]
        },
        {
          id: "C10",
          nom: "Établir le budget prévisionnel de l'opération",
          connaissances: [
            { nom: "Économie de la construction", niveau: 4 }
          ],
          criteres: [
            "Le déboursé sec d'un ouvrage élémentaire est budgété : main d'œuvre, matériaux, matériels, consommables, sous-traitants",
            "Les frais de chantier sont listés",
            "Pour budgéter les matériaux et le matériel, les fournisseurs sont éventuellement consultés"
          ],
          taches: ["T2.13"]
        }
      ]
    },
    {
      id: 3,
      nom: "Suivi et encadrement d'un projet",
      unite: "U7",
      poles: [
        {
          id: "A3.1",
          nom: "Suivi d'un projet",
          conditionsExercice: {
            moyens: [
              "Dossier marché (CCTP, plans d'architecte, études de sols, PGC, plan de prévention…)",
              "Dossier d'exécution",
              "Dossier méthodes (PIC, plannings, rotations, phasage, sécurité, modes opératoires…)",
              "Données du site (bâtiment neuf ou existant)",
              "Base de données entreprise (temps unitaires, cadences…)",
              "Réglementations, normes, certifications en vigueur",
              "Démarche QSE de l'entreprise",
              "Démarche RSE de l'entreprise si elle existe (démarche bas carbone…)",
              "Environnement professionnel de l'entreprise (progiciels, matériel, outils numériques, formulaires…)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T3.1": [
              "La visite du chantier est effectuée",
              "L'état d'avancement des ouvrages est estimé",
              "La mise en place des dispositifs de sécurité est contrôlée tout au long du chantier",
              "La conformité des ouvrages est vérifiée",
              "L'avancement des travaux est reporté sur le planning d'exécution"
            ],
            "T3.2": [
              "Les situations sont établies suivant l'avancement des travaux",
              "Les données sont transmises pour facturation",
              "Les dépenses communes sont transmises pour établissement des factures du compte prorata"
            ],
            "T3.3": [
              "Le plan d'assurance qualité de l'entreprise est appliqué (points d'arrêt, points de contrôle, mesures de reprise, gestion des non-conformités...)",
              "Les ouvrages sont contrôlés tout au long du projet",
              "Les données du projet sont suivies et mises à jour",
              "Les résultats sont consignés et réalisés"
            ],
            "T3.4": [
              "Le contenu de la communication est adapté au contexte et à l'interlocuteur (arguments, éléments de langage…)",
              "Les moyens de communication sont appropriés au contexte",
              "Les communications sont préparées",
              "Les interventions sont assurées, suivies, comprises par les destinataires, et contrôlées avec la qualité attendue",
              "Les arguments des interlocuteurs sont pris en compte",
              "Les comptes rendus formels et informels sont assurés à l'écrit ou à l'oral et conformes aux attendus"
            ],
            "T3.5": [
              "Les réglementations, normes, recommandations et certifications en vigueur sont connues et appliquées",
              "La veille technologique est assurée"
            ],
            "T3.6": [
              "Le contrôle des factures des fournisseurs est réalisé",
              "Le suivi des crédits d'heures est assuré",
              "Le suivi de la consommation des produits et matériaux est fait",
              "Les résultats intermédiaires sont analysés en vue d'une optimisation éventuelle",
              "Les écarts avec le budget sont analysés, le budget est éventuellement recalé"
            ]
          },
          taches: [
            { id: "T3.1", nom: "Contrôle et suivi de l'avancement du projet", competences: ["C11"] },
            { id: "T3.2", nom: "Établissement des situations d'avancement de travaux", competences: ["C11"] },
            { id: "T3.3", nom: "Suivi du processus management qualité de l'entreprise", competences: ["C13"] },
            { id: "T3.4", nom: "Participation à une réunion", competences: ["C12"] },
            { id: "T3.5", nom: "Application des réglementations, des normes et des certifications en vigueur", competences: ["C13"] },
            { id: "T3.6", nom: "Suivi du budget du chantier", competences: ["C11"] }
          ]
        },
        {
          id: "A3.2",
          nom: "Encadrement d'un projet",
          conditionsExercice: {
            moyens: [
              "Dossier marché (CCTP, plans d'architecte, études de sols, PGC…)",
              "Dossier d'exécution",
              "Dossier méthodes (PIC, plannings, rotations, phasage, sécurité, modes opératoires…)",
              "Données du site (bâtiment neuf ou existant)",
              "Base de données entreprise (temps unitaires, cadences…)",
              "Réglementations, normes, certifications en vigueur",
              "Démarche QSE de l'entreprise",
              "Démarche RSE de l'entreprise si elle existe (démarche bas carbone…)",
              "Environnement professionnel de l'entreprise (progiciels, matériel, outils numériques, formulaires…)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T3.7": [
              "Les différents intervenants sont identifiés",
              "Les interfaces avec les autres corps d'état sont définies ou prises en compte",
              "La mutualisation des moyens est analysée",
              "La coactivité est anticipée et gérée",
              "Les rôles et responsabilités de chacun sont identifiés",
              "Les relations et interfaces avec les parties prenantes sont préparées et assurées (MOA, MOE, riverains, concessionnaires, CARSAT, DREETS…)"
            ],
            "T3.8": [
              "L'accueil, l'information, la formation des équipes sont réalisés",
              "La présentation des travaux confiés à l'équipe est préparée",
              "Les rôles et responsabilités de chacun sont définis, attribués, délégués si besoin",
              "L'animation de l'équipe est assurée",
              "Les règles de travail de l'entreprise et du chantier sont mises en œuvre",
              "Les imprévus, difficultés ou conflits de l'équipe sont pris en compte et sont gérés",
              "La posture de représentant de l'entreprise est adaptée aux différents contextes"
            ],
            "T3.9": [
              "Les salariés sont accueillis (livret et fiche d'accueil) et la formation au poste de travail est dispensée",
              "Les documents réglementaires sont contrôlés et appliqués (habilitations, certifications, CACES, autorisations…)",
              "Les règles, les moyens de prévention et de protection sont appliqués",
              "Les informations et les formations sont mises en œuvre (quart d'heure sécurité, nutrition, éveil musculaire, postures)",
              "Les situations à risques sont identifiées, traitées et les parties prenantes en sont informées",
              "Les moyens de prévention prévus sont adaptés en continu au site",
              "Les situations d'urgence, les incidents, les presqu'accidents sont gérés",
              "Les consignes de vérification, d'utilisation et de guidage des matériels et outils sont contrôlées et appliquées",
              "Les équipements sont contrôlés (sécurité, étalonnage)",
              "La VGP des équipements est à jour et les réserves sont levées",
              "Les marquages, la signalisation de chantier et les protections sont maintenus en état"
            ],
            "T3.10": [
              "L'empreinte environnementale du chantier est minimisée",
              "La gestion des déchets est contrôlée et appliquée",
              "Les prestataires d'évacuation sont identifiés",
              "Les stations de lavage sont en place",
              "Les contraintes et les risques de nuisances sont traités (bruit, pollution)",
              "Les ressources sont économisées dans le cadre d'une démarche écoresponsable"
            ],
            "T3.11": [
              "Les plannings de livraison sont établis et coordonnés (DHOL)",
              "Le suivi et le contrôle des commandes et des livraisons des matériels et des matériaux sont assurés et explicités",
              "Les zones de stockage et de livraison sont respectées",
              "Les procédures de maintenance et de dépannage sont appliquées",
              "Les démarches d'optimisation sont initiées",
              "Les tâches à zéro valeur ajoutée sont éliminées"
            ]
          },
          taches: [
            { id: "T3.7", nom: "Prise en compte des différents intervenants du projet", competences: ["C12"] },
            { id: "T3.8", nom: "Management d'une équipe", competences: ["C12"] },
            { id: "T3.9", nom: "Organisation et mise en œuvre de la sécurité des personnes et des biens", competences: ["C13"] },
            { id: "T3.10", nom: "Organisation et mise en œuvre des mesures environnementales sur chantier", competences: ["C13"] },
            { id: "T3.11", nom: "Organisation, logistique et gestion des matériels et des matériaux", competences: ["C12"] }
          ]
        }
      ],
      competences: [
        {
          id: "C11",
          nom: "Assurer le suivi de l'opération",
          connaissances: [
            { nom: "Préparation et organisation de chantier", niveau: 4 },
            { nom: "Économie de la construction", niveau: 4 }
          ],
          criteres: [
            "La gestion des plannings est suivie, analysée, et des ajustements sont proposés si besoin",
            "La participation à une réunion est effective et un compte rendu est rédigé",
            "Les situations d'avancement de travaux sont analysées",
            "Un relevé de cadence et de consommations est réalisé sur la production d'un ouvrage",
            "La procédure de suivi des coûts du chantier est analysée",
            "Les écarts entre le prévisionnel et le réel sont analysés et des actions correctives sont proposées",
            "La réception des ouvrages est préparée et formalisée dans une fiche"
          ],
          taches: ["T3.1", "T3.2", "T3.4", "T3.6", "T3.11"]
        },
        {
          id: "C12",
          nom: "Participer au management d'une équipe",
          connaissances: [
            { nom: "Connaissances transversales", niveau: 4 }
          ],
          criteres: [
            "Des activités de management observées sont analysées : accueil, formation au poste, information des équipes",
            "Les différents intervenants sont identifiés et leur rôle est explicité, les interfaces avec les autres corps d'état sont explicitées",
            "La communication orale et écrite est adaptée à la situation et à l'interlocuteur",
            "Une consigne de réalisation d'une tâche est transmise et explicitée à partir de la lecture de plans",
            "Les comptes rendus formels et informels sont assurés à l'écrit ou à l'oral",
            "La collaboration et l'encadrement de la réalisation des projets sont observés et analysés"
          ],
          taches: ["T3.7", "T3.8"]
        },
        {
          id: "C13",
          nom: "Participer à la mise en œuvre des mesures de sécurité des personnes et des biens, des mesures environnementales et de la démarche qualité",
          connaissances: [
            { nom: "Connaissances transversales", niveau: 4 }
          ],
          criteres: [
            "La prévention des risques pour la santé et la sécurité est analysée : documents réglementaires, situations à risques, moyens de prévention, gestion des situations d'urgence",
            "Les consignes de vérification, d'utilisation et de guidage des matériels et outils sont maîtrisées",
            "La VGP et le contrôle des équipements sont suivis",
            "Les démarches environnementales sont analysées : documents réglementaires, gestion des déchets, traitement des eaux, nuisances",
            "Le processus management qualité de l'entreprise est analysé : plan d'assurance qualité, contrôle des ouvrages, fiches d'autocontrôle"
          ],
          taches: ["T3.3", "T3.5", "T3.9", "T3.10"]
        }
      ]
    },
    {
      id: 4,
      nom: "Contrôle qualité et réception des ouvrages",
      unite: "U8",
      poles: [
        {
          id: "A4.1",
          nom: "Réception et implantation",
          conditionsExercice: {
            moyens: [
              "Dossier marché (CCTP, plans d'architecte, études de sols, PGC…)",
              "Dossier d'exécution",
              "Dossier méthodes (PIC, plannings, rotations, phasage, sécurité, modes opératoires…)",
              "Données du site (bâtiment neuf ou existant)",
              "Base de données entreprise (temps unitaires, cadences…)",
              "Réglementations, normes, certifications en vigueur",
              "Démarche QSE de l'entreprise",
              "Démarche RSE de l'entreprise si elle existe (démarche bas carbone…)",
              "Environnement professionnel de l'entreprise (progiciels, matériel, outils numériques, formulaires…)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T4.1": [
              "Le plan de contrôle est établi en précisant les tolérances requises",
              "Le relevé des supports en altimétrie et planimétrie est effectué",
              "La fiche de réception du lot en interface est établie en indiquant, le cas échéant, les mesures correctives exigées"
            ],
            "T4.2": [
              "L'implantation des limites du chantier est matérialisée, ainsi que la localisation des principales zones du chantier (accès, stockages, sécurités…)",
              "L'implantation des ouvrages est réalisée"
            ]
          },
          taches: [
            { id: "T4.1", nom: "Réception des supports et validation des interfaces", competences: ["C14"] },
            { id: "T4.2", nom: "Implantation des ouvrages", competences: ["C14"] }
          ]
        },
        {
          id: "A4.2",
          nom: "Contrôle et validation",
          conditionsExercice: {
            moyens: [
              "Dossier marché (CCTP, plans d'architecte, études de sols, PGC…)",
              "Dossier d'exécution",
              "Dossier méthodes (PIC, plannings, rotations, phasage, sécurité, modes opératoires…)",
              "Données du site (bâtiment neuf ou existant)",
              "Base de données entreprise (temps unitaires, cadences…)",
              "Réglementations, normes, certifications en vigueur",
              "Démarche QSE de l'entreprise",
              "Démarche RSE de l'entreprise si elle existe (démarche bas carbone…)",
              "Environnement professionnel de l'entreprise (progiciels, matériel, outils numériques, formulaires…)"
            ],
            autonomie: "Partielle"
          },
          resultatsAttendus: {
            "T4.3": [
              "Les fiches de réceptions sont remplies",
              "Les contrôles des solutions techniques et des matériaux sont réalisés",
              "Les contrôles des ouvrages sont réalisés conformément au plan de contrôle",
              "Les fiches de contrôles sont établies et transmises",
              "Les non conformités sont identifiées et traitées"
            ]
          },
          taches: [
            { id: "T4.3", nom: "Vérification et validation des solutions techniques, des matériaux et des ouvrages réalisés", competences: ["C15"] }
          ]
        }
      ],
      competences: [
        {
          id: "C14",
          nom: "Implanter et vérifier les caractéristiques géométriques des ouvrages",
          connaissances: [
            { nom: "Implantations - Contrôles", niveau: 4 }
          ],
          criteres: [
            "Des points ou des axes sont implantés : travaux préparés, données établies de manière informatique, implantations réalisées et contrôlées",
            "Les traits de niveau sont positionnés",
            "Les interfaces sont validées",
            "Des coffrages, des inserts sont tracés pour les ouvrages courants",
            "Les relevés d'ouvrages sont réalisés suivant un plan de contrôle : géométrie, dimensions, positionnement"
          ],
          taches: ["T4.1", "T4.2"]
        },
        {
          id: "C15",
          nom: "Contrôler les matériaux, les ouvrages et les solutions techniques",
          connaissances: [
            { nom: "Sciences de la construction", niveau: 4 }
          ],
          criteres: [
            "Le protocole de réalisation des essais est assuré : objectif identifié, paramètres à contrôler identifiés, protocole défini",
            "Le matériel est préparé et l'essai est réalisé",
            "Les résultats sont exploités et analysés",
            "Les caractéristiques environnementales et le bilan carbone sont analysés"
          ],
          taches: ["T4.3"]
        }
      ]
    }
  ]
};

const niveauLabels = {
  1: "Information (Notion)",
  2: "Expression (Compréhension)",
  3: "Maîtrise d'outils (Application)",
  4: "Maîtrise méthodologique (Analyse)"
};

function FormulaireBTSEBCR() {
  const [selectedBloc, setSelectedBloc] = useState(null);
  const [selectedPole, setSelectedPole] = useState(null);
  const [selectedTache, setSelectedTache] = useState(null);
  const [selectedCompetence, setSelectedCompetence] = useState(null);
  const [viewMode, setViewMode] = useState('competences');
  const [showSeanceModal, setShowSeanceModal] = useState(false); // Gardé pour compatibilité mais non utilisé
  
  // États pour le mode édition de séance
  const [editMode, setEditMode] = useState(false);
  const [seanceNumero, setSeanceNumero] = useState('');
  const [seanceTitre, setSeanceTitre] = useState('');
  const [onDonne, setOnDonne] = useState({});
  const [onDonneDetails, setOnDonneDetails] = useState({});
  const [onDemande, setOnDemande] = useState(''); // Champ libre pour ON DEMANDE
  const [selectedAttendus, setSelectedAttendus] = useState({}); // Résultats attendus cochés
  const [customAttendus, setCustomAttendus] = useState({}); // Textes personnalisés pour les attendus
  const [customOnDemande, setCustomOnDemande] = useState([]); // Attendus personnalisés ajoutés par l'utilisateur
  const [customFields, setCustomFields] = useState({}); // Champs personnalisés par catégorie
  const [expandedCategories, setExpandedCategories] = useState({}); // Catégories dépliées
  const [selectedSavoirs, setSelectedSavoirs] = useState({}); // Connaissances globales sélectionnées
  const [logoLycee, setLogoLycee] = useState(null); // Logo du lycée uploadé

  // Fonction pour gérer l'upload du logo
  const handleLogoUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        setLogoLycee(event.target.result);
      };
      reader.readAsDataURL(file);
    }
  };

  // Fonction pour transformer les résultats attendus passifs en phrases indicatives actives
  const transformerEnIndicatif = (texte) => {
    // Dictionnaire de transformations passif -> indicatif actif
    const transformations = [
      // Patterns avec "est/sont + participe passé" -> verbe actif
      { pattern: /^Une synthèse globale justifiée et structurée est rédigée/i, replacement: "Rédiger une synthèse globale justifiée et structurée" },
      { pattern: /^Les plans de structure sont produits$/i, replacement: "Produire les plans de structure" },
      { pattern: /^Les éléments porteurs et leurs impacts sont identifiés$/i, replacement: "Identifier les éléments porteurs et leurs impacts" },
      { pattern: /^Les incohérences éventuelles sont relevées$/i, replacement: "Relever les incohérences éventuelles" },
      { pattern: /^Des solutions simples et adaptées sont proposées$/i, replacement: "Proposer des solutions simples et adaptées" },
      { pattern: /^Des plans d'exécution sont réalisés$/i, replacement: "Réaliser des plans d'exécution" },
      { pattern: /^Le PGCSPS est analysé/i, replacement: "Analyser le PGCSPS" },
      { pattern: /^Le PPSPS est complété/i, replacement: "Compléter le PPSPS avec le PIC, les modes opératoires…" },
      { pattern: /^Les risques sont identifiés et évalués$/i, replacement: "Identifier et évaluer les risques" },
      { pattern: /^Les moyens de prévention sont choisis/i, replacement: "Choisir les moyens de prévention en fonction de l'évaluation et des principes généraux de prévention" },
      { pattern: /^Les risques environnementaux sont anticipés$/i, replacement: "Anticiper les risques environnementaux" },
      { pattern: /^Les acteurs sont identifiés$/i, replacement: "Identifier les acteurs" },
      { pattern: /^Les documents réglementaires et normatifs sont connus et complétés$/i, replacement: "Connaître et compléter les documents réglementaires et normatifs" },
      { pattern: /^Les méthodes de gestion des déchets sont mises en place$/i, replacement: "Mettre en place les méthodes de gestion des déchets" },
      { pattern: /^L'impact environnemental est optimisé$/i, replacement: "Optimiser l'impact environnemental" },
      { pattern: /^Le CCTP est analysé/i, replacement: "Analyser le CCTP en identifiant les exigences de qualité" },
      { pattern: /^Les points singuliers et les interfaces sur chantier sont identifiés$/i, replacement: "Identifier les points singuliers et les interfaces sur chantier" },
      { pattern: /^Les services compétents.*sont informés/i, replacement: "Informer les services compétents (DREETS, CARSAT, OPPBTP…) de l'ouverture du chantier" },
      { pattern: /^À partir de la déclaration de travaux, les DICT sont demandées/i, replacement: "Demander, étudier et exploiter les DICT à partir de la déclaration de travaux" },
      { pattern: /^Les autorisations nécessaires.*sont demandées/i, replacement: "Demander les autorisations nécessaires (voirie, survol, engins de levage…) aux services compétents" },
      { pattern: /^Le planning de chantier objectif est réalisé/i, replacement: "Réaliser le planning de chantier objectif à partir du planning client (avec marge de sécurité)" },
      { pattern: /^Les modes constructifs possibles sont comparés/i, replacement: "Comparer les modes constructifs possibles et justifier le choix selon les contraintes techniques, économiques, environnementales et de prévention" },
      { pattern: /^Un tableau de synthèse est réalisé$/i, replacement: "Réaliser un tableau de synthèse" },
      { pattern: /^Les équipes sont définies$/i, replacement: "Définir les équipes" },
      { pattern: /^Le type et la quantité de matériel sont définis/i, replacement: "Définir et optimiser le type et la quantité de matériel" },
      { pattern: /^La charge de grue est réalisée/i, replacement: "Réaliser la charge de grue de manière cohérente" },
      { pattern: /^Le type et la quantité de matériaux sont définis/i, replacement: "Définir et optimiser le type et la quantité de matériaux" },
      { pattern: /^Le mode de fabrication du béton est choisi$/i, replacement: "Choisir le mode de fabrication du béton" },
      { pattern: /^Les ouvrages élémentaires sont décomposés et quantifiés$/i, replacement: "Décomposer et quantifier les ouvrages élémentaires" },
      { pattern: /^Le planning réalisé fait apparaître/i, replacement: "Faire apparaître dans le planning : la décomposition des tâches, l'enclenchement, la durée, les cadences" },
      { pattern: /^Les jours non travaillés.*sont intégrés$/i, replacement: "Intégrer les jours non travaillés (congés, jours fériés, intempéries)" },
      { pattern: /^Les principales phases de logistique.*sont définis$/i, replacement: "Définir les principales phases logistiques (livraisons…), les dates-jalons et le phasage" },
      { pattern: /^La courbe de main d'œuvre est établie$/i, replacement: "Établir la courbe de main d'œuvre" },
      { pattern: /^Le cyclage des verticaux et des horizontaux est réalisé$/i, replacement: "Réaliser le cyclage des verticaux et des horizontaux" },
      { pattern: /^La rotation du matériel.*est réalisable/i, replacement: "Vérifier que la rotation du matériel (coffrage et sécurité) est réalisable et cohérente" },
      { pattern: /^Le calepinage des éléments préfabriqués est défini$/i, replacement: "Définir le calepinage des éléments préfabriqués" },
      { pattern: /^Le plan d'installation de chantier est réalisé/i, replacement: "Réaliser et mettre à jour le plan d'installation de chantier selon l'avancement" },
      { pattern: /^Les moyens relatifs aux exigences.*sont définis$/i, replacement: "Définir les moyens relatifs aux exigences de qualité, de prévention et environnementales" },
      { pattern: /^Les engins de levage sont choisis/i, replacement: "Choisir, dimensionner et positionner les engins de levage en intégrant les phases de montage/démontage" },
      { pattern: /^Les zones de stockage sont définies$/i, replacement: "Définir les zones de stockage" },
      { pattern: /^La base vie, les accès/i, replacement: "Définir la base vie, les accès, les circulations, les clôtures, les réseaux et les zones" },
      { pattern: /^Les moyens de prévention sont choisis en fonction de cette évaluation$/i, replacement: "Choisir les moyens de prévention en fonction de l'évaluation" },
      { pattern: /^Le matériel est choisi et adapté$/i, replacement: "Choisir et adapter le matériel" },
      { pattern: /^Les méthodes d'exécution sont définies$/i, replacement: "Définir les méthodes d'exécution" },
      { pattern: /^Les éléments suivants sont budgétés/i, replacement: "Budgéter les éléments suivants dans le cadre d'un déboursé sec : main d'œuvre, matériaux, matériels, sous-traitants" },
      { pattern: /^Les frais de chantier sont évalués$/i, replacement: "Évaluer les frais de chantier" },
      { pattern: /^Pour budgéter les matériaux.*sont consultés$/i, replacement: "Consulter les fournisseurs pour budgéter les matériaux et le matériel" },
      // Bloc 3 - Suivi et encadrement
      { pattern: /^Le bilan de chantier est réalisé$/i, replacement: "Réaliser le bilan de chantier" },
      { pattern: /^Les ressources sont suivies et optimisées$/i, replacement: "Suivre et optimiser les ressources" },
      { pattern: /^Les délais sont suivis$/i, replacement: "Suivre les délais" },
      { pattern: /^Le budget travaux est actualisé$/i, replacement: "Actualiser le budget travaux" },
      { pattern: /^Les écarts sont analysés$/i, replacement: "Analyser les écarts" },
      { pattern: /^Des mesures correctives sont proposées$/i, replacement: "Proposer des mesures correctives" },
      { pattern: /^Les documents de suivi sont renseignés$/i, replacement: "Renseigner les documents de suivi" },
      { pattern: /^La situation de travaux est établie$/i, replacement: "Établir la situation de travaux" },
      { pattern: /^Les avenants sont préparés$/i, replacement: "Préparer les avenants" },
      { pattern: /^Le DOE est constitué$/i, replacement: "Constituer le DOE" },
      { pattern: /^Les réserves sont levées$/i, replacement: "Lever les réserves" },
      { pattern: /^Les consignes sont transmises$/i, replacement: "Transmettre les consignes" },
      { pattern: /^L'équipe est organisée$/i, replacement: "Organiser l'équipe" },
      { pattern: /^Les besoins en formation sont identifiés$/i, replacement: "Identifier les besoins en formation" },
      { pattern: /^Le compte rendu de réunion est rédigé$/i, replacement: "Rédiger le compte rendu de réunion" },
      { pattern: /^Les réunions sont préparées$/i, replacement: "Préparer les réunions" },
      // Bloc 4 - Implantation et contrôle
      { pattern: /^Le plan de contrôle est établi/i, replacement: "Établir le plan de contrôle en précisant les tolérances requises" },
      { pattern: /^Le relevé des supports.*est effectué$/i, replacement: "Effectuer le relevé des supports en altimétrie et planimétrie" },
      { pattern: /^La fiche de réception du lot.*est établie/i, replacement: "Établir la fiche de réception du lot en interface avec les mesures correctives exigées" },
      { pattern: /^L'implantation des limites du chantier est matérialisée/i, replacement: "Matérialiser l'implantation des limites du chantier et la localisation des principales zones" },
      { pattern: /^L'implantation des ouvrages est réalisée$/i, replacement: "Réaliser l'implantation des ouvrages" },
      { pattern: /^Les fiches de réceptions sont remplies$/i, replacement: "Remplir les fiches de réception" },
      { pattern: /^Les contrôles des solutions techniques.*sont réalisés$/i, replacement: "Réaliser les contrôles des solutions techniques et des matériaux" },
      { pattern: /^Les contrôles des ouvrages sont réalisés/i, replacement: "Réaliser les contrôles des ouvrages conformément au plan de contrôle" },
      { pattern: /^Les fiches de contrôles sont établies/i, replacement: "Établir et transmettre les fiches de contrôles" },
      { pattern: /^Les non conformités sont identifiées/i, replacement: "Identifier et traiter les non-conformités" },
    ];

    // Appliquer les transformations
    for (const { pattern, replacement } of transformations) {
      if (pattern.test(texte)) {
        return replacement;
      }
    }

    // Si aucune transformation spécifique, tenter une transformation générique
    // Pattern: "X est/sont + participe" -> "Verbe + X"
    const genericPatterns = [
      { pattern: /^(.+?)\s+(?:est|sont)\s+(réalisé|réalisée|réalisés|réalisées)$/i, verb: "Réaliser" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(défini|définie|définis|définies)$/i, verb: "Définir" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(identifié|identifiée|identifiés|identifiées)$/i, verb: "Identifier" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(établi|établie|établis|établies)$/i, verb: "Établir" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(analysé|analysée|analysés|analysées)$/i, verb: "Analyser" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(vérifié|vérifiée|vérifiés|vérifiées)$/i, verb: "Vérifier" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(choisi|choisie|choisis|choisies)$/i, verb: "Choisir" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(préparé|préparée|préparés|préparées)$/i, verb: "Préparer" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(complété|complétée|complétés|complétées)$/i, verb: "Compléter" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(produit|produite|produits|produites)$/i, verb: "Produire" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(transmis|transmise)$/i, verb: "Transmettre" },
      { pattern: /^(.+?)\s+(?:est|sont)\s+(renseigné|renseignée|renseignés|renseignées)$/i, verb: "Renseigner" },
    ];

    for (const { pattern, verb } of genericPatterns) {
      const match = texte.match(pattern);
      if (match) {
        // Transformer "Les X sont réalisés" -> "Réaliser les X"
        let sujet = match[1];
        // Mettre en minuscule la première lettre du sujet
        sujet = sujet.charAt(0).toLowerCase() + sujet.slice(1);
        return `${verb} ${sujet}`;
      }
    }

    // Si toujours pas de transformation, retourner le texte original
    return texte;
  };

  const currentBloc = useMemo(() => 
    data.blocs.find(b => b.id === selectedBloc), 
    [selectedBloc]
  );

  const currentPole = useMemo(() => 
    currentBloc?.poles.find(p => p.id === selectedPole), 
    [currentBloc, selectedPole]
  );

  const currentTache = useMemo(() => 
    currentPole?.taches.find(t => t.id === selectedTache), 
    [currentPole, selectedTache]
  );

  const currentCompetence = useMemo(() => 
    currentBloc?.competences.find(c => c.id === selectedCompetence), 
    [currentBloc, selectedCompetence]
  );

  // Calcul des compétences disponibles selon la tâche sélectionnée
  const availableCompetences = useMemo(() => {
    if (!currentBloc) return [];
    
    if (selectedTache && currentTache) {
      // Si une tâche est sélectionnée, ne montrer que les compétences liées à cette tâche
      return currentBloc.competences.filter(comp => 
        currentTache.competences?.includes(comp.id)
      );
    }
    
    if (selectedPole && currentPole) {
      // Si un pôle est sélectionné, montrer les compétences liées à toutes les tâches du pôle
      const competenceIds = new Set();
      currentPole.taches.forEach(tache => {
        tache.competences?.forEach(compId => competenceIds.add(compId));
      });
      return currentBloc.competences.filter(comp => competenceIds.has(comp.id));
    }
    
    // Sinon, montrer toutes les compétences du bloc
    return currentBloc.competences;
  }, [currentBloc, currentPole, currentTache, selectedPole, selectedTache]);

  const resetFilters = () => {
    setSelectedBloc(null);
    setSelectedPole(null);
    setSelectedTache(null);
    setSelectedCompetence(null);
  };

  const handleBlocChange = (value) => {
    setSelectedBloc(value ? parseInt(value) : null);
    setSelectedPole(null);
    setSelectedTache(null);
    setSelectedCompetence(null);
  };

  const handlePoleChange = (value) => {
    setSelectedPole(value || null);
    setSelectedTache(null);
    setSelectedCompetence(null); // Réinitialiser la compétence car les options changent
  };

  const handleTacheChange = (value) => {
    setSelectedTache(value || null);
    setSelectedCompetence(null); // Réinitialiser la compétence car les options changent selon la tâche
  };

  const handleCompetenceChange = (value) => {
    setSelectedCompetence(value || null);
  };

  // Fonction pour générer et exporter le PDF en format paysage
  const exportToPDF = () => {
    const printWindow = window.open('', '_blank');
    
    // Organiser les documents cochés par catégorie
    const documentsParCategorie = {};
    Object.entries(onDonne)
      .filter(([_, checked]) => checked)
      .forEach(([key, _]) => {
        const parts = key.split('::');
        const category = parts[0];
        const isCustom = parts[1] === 'custom';
        
        if (!documentsParCategorie[category]) {
          documentsParCategorie[category] = [];
        }
        
        if (isCustom) {
          const fieldId = parseInt(parts[2]);
          const customField = (customFields[category] || []).find(f => f.id === fieldId);
          if (customField && customField.nom) {
            documentsParCategorie[category].push({
              nom: customField.nom + ' (personnalisé)',
              detail: customField.detail || ''
            });
          }
        } else {
          const itemName = parts.slice(1).join(' > ');
          documentsParCategorie[category].push({
            nom: itemName,
            detail: onDonneDetails[key] || ''
          });
        }
      });

    // Récupérer les savoirs sélectionnés
    const savoirsSelectionnes = connaissancesGlobales.filter(c => selectedSavoirs[c.id]);

    const htmlContent = `
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Fiche de Séance${seanceNumero ? ' N°' + seanceNumero : ''} - BTS Bâtiment</title>
    <style>
        /* Format A4 paysage : 297mm x 210mm (ratio 1.414) */
        @page { 
            size: 297mm 210mm landscape;
            margin: 0;
        }
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        html { 
            width: 297mm;
            height: 210mm;
        }
        body { 
            width: 297mm;
            height: 210mm;
            font-family: Arial, Helvetica, sans-serif; 
            font-size: 8pt;
            line-height: 1.25;
            color: #1e293b;
            overflow: hidden;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            background: white;
        }
        .page-container {
            width: 297mm;
            height: 210mm;
            max-width: 297mm;
            max-height: 210mm;
            padding: 5mm;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            page-break-after: avoid;
            page-break-inside: avoid;
        }
        .header { 
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 3mm 5mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 2mm;
            margin-bottom: 3mm;
            flex-shrink: 0;
        }
        .header h1 { 
            font-size: 13pt;
            font-weight: 700;
        }
        .header-right {
            text-align: right;
            font-size: 9pt;
            display: flex;
            align-items: center;
            gap: 4mm;
        }
        .header-right .seance-num {
            font-size: 11pt;
            font-weight: 700;
            background: rgba(255,255,255,0.2);
            padding: 1.5mm 3mm;
            border-radius: 1.5mm;
        }
        .main-content {
            display: flex;
            gap: 4mm;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }
        .column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2mm;
            overflow: hidden;
            min-height: 0;
        }
        .column-left {
            background: #f8fafc;
            border: 0.5mm solid #3b82f6;
            border-radius: 2mm;
            padding: 3mm;
        }
        .column-right {
            background: #f8fafc;
            border: 0.3mm solid #cbd5e1;
            border-radius: 2mm;
            padding: 3mm;
        }
        .column-title {
            font-size: 9pt;
            font-weight: 700;
            padding: 1.5mm 3mm;
            border-radius: 1.5mm;
            text-align: center;
            flex-shrink: 0;
            margin-bottom: 2mm;
        }
        .column-left .column-title {
            background: #3b82f6;
            color: white;
        }
        .column-right .column-title {
            background: #64748b;
            color: white;
        }
        .section {
            margin-bottom: 2mm;
            flex-shrink: 0;
        }
        .section.flex-1 {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }
        .section-title {
            font-size: 8pt;
            font-weight: 700;
            color: white;
            padding: 1mm 2mm;
            border-radius: 1mm;
            margin-bottom: 1mm;
        }
        .section-title.blue { background: #2563eb; }
        .section-title.green { background: #16a34a; }
        .section-title.purple { background: #7c3aed; }
        .section-title.orange { background: #ea580c; }
        .section-title.red { background: #dc2626; }
        .section-title.gray { background: #64748b; }
        .section-content {
            font-size: 7.5pt;
            padding: 2mm;
            background: white;
            border-radius: 1mm;
            border: 0.2mm solid #e2e8f0;
            overflow: hidden;
        }
        .section-content.scrollable {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        .badge {
            display: inline-block;
            padding: 0.5mm 1.5mm;
            border-radius: 1mm;
            font-size: 7pt;
            font-weight: 600;
            margin-right: 1.5mm;
        }
        .badge-bloc { background: #dbeafe; color: #1e40af; }
        .badge-pole { background: #dcfce7; color: #166534; }
        .badge-tache { background: #f3e8ff; color: #7c3aed; }
        .badge-comp { background: #fef3c7; color: #b45309; }
        .info-row {
            margin-bottom: 0.5mm;
            padding: 0.5mm 0;
            font-size: 7.5pt;
        }
        .list-compact {
            margin: 0;
            padding-left: 4mm;
        }
        .list-compact li {
            margin-bottom: 0.5mm;
            font-size: 7.5pt;
        }
        .competence-mini {
            background: #f1f5f9;
            padding: 1.5mm 2mm;
            border-radius: 1mm;
            margin-bottom: 1.5mm;
            border-left: 0.8mm solid #3b82f6;
        }
        .competence-mini-title {
            font-weight: 600;
            color: #1e40af;
            font-size: 7.5pt;
        }
        .criteres-list {
            font-size: 7pt;
            color: #475569;
            margin-top: 0.5mm;
        }
        .on-donne-category {
            margin-bottom: 2mm;
        }
        .on-donne-category-title {
            background: #e2e8f0;
            color: #475569;
            padding: 1mm 2mm;
            font-weight: 600;
            font-size: 7pt;
            border-radius: 0.5mm;
            margin-bottom: 1mm;
        }
        .on-donne-item {
            padding: 1mm 2mm;
            background: #f8fafc;
            margin-bottom: 0.5mm;
            border-left: 0.6mm solid #94a3b8;
            font-size: 7.5pt;
        }
        .on-donne-detail {
            color: #64748b;
            font-style: italic;
            font-size: 7pt;
        }
        .on-demande-box {
            background: white;
            border: 0.3mm solid #cbd5e1;
            border-radius: 1mm;
            padding: 2mm;
            white-space: pre-wrap;
            font-size: 8pt;
            flex: 1;
            overflow-y: auto;
        }
        .seance-header {
            background: #475569;
            color: white;
            padding: 2mm 3mm;
            border-radius: 1.5mm;
            text-align: center;
            flex-shrink: 0;
            margin-bottom: 2mm;
        }
        .seance-header .numero {
            font-size: 11pt;
            font-weight: 700;
        }
        .seance-header .titre {
            font-size: 9pt;
            margin-top: 1mm;
            font-weight: 400;
        }
        .savoir-item {
            display: inline-block;
            background: #dcfce7;
            color: #166534;
            padding: 0.5mm 1.5mm;
            border-radius: 1mm;
            font-size: 7pt;
            margin: 0.5mm;
        }
        .footer {
            font-size: 7pt;
            color: #94a3b8;
            text-align: center;
            padding: 1.5mm 0 0 0;
            flex-shrink: 0;
            margin-top: auto;
        }
        @media print {
            @page {
                size: 297mm 210mm landscape;
                margin: 0;
            }
            html, body { 
                width: 297mm;
                height: 210mm;
                overflow: hidden;
            }
            .page-container {
                width: 297mm;
                height: 210mm;
                max-width: 297mm;
                max-height: 210mm;
                page-break-after: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <h1>📋 FICHE DE SÉANCE - BTS BÂTIMENT</h1>
            </div>
            <div class="header-right">
                ${seanceNumero ? `<span class="seance-num">Séance N° ${seanceNumero}</span>` : ''}
                <div style="font-size: 8pt;">${new Date().toLocaleDateString('fr-FR')}</div>
                ${logoLycee ? `<img src="${logoLycee}" style="height: 12mm; border-radius: 1mm;" alt="Logo Lycée">` : ''}
            </div>
        </div>

        <div class="main-content">
            <!-- COLONNE GAUCHE : RÉFÉRENTIEL -->
            <div class="column column-left">
                <div class="column-title">📚 RÉFÉRENTIEL BTS BÂTIMENT</div>
                
                <!-- Bloc et Pôle -->
                <div class="section">
                    <div class="section-title blue">📍 Contexte</div>
                    <div class="section-content">
                        ${currentBloc ? `<div class="info-row"><span class="badge badge-bloc">${currentBloc.unite}</span> <b>Bloc ${currentBloc.id}</b> - ${currentBloc.nom}</div>` : ''}
                        ${currentPole ? `<div class="info-row"><span class="badge badge-pole">${currentPole.id}</span> ${currentPole.nom}</div>` : ''}
                        ${currentTache ? `<div class="info-row"><span class="badge badge-tache">${currentTache.id}</span> ${currentTache.nom}</div>` : ''}
                    </div>
                </div>

                <!-- Moyens et ressources -->
                ${currentPole?.conditionsExercice ? `
                <div class="section">
                    <div class="section-title green">🔧 Moyens / Ressources</div>
                    <div class="section-content">
                        <div style="font-size: 6pt;">${currentPole.conditionsExercice.moyens.slice(0, 5).join(' • ')}${currentPole.conditionsExercice.moyens.length > 5 ? ' •...' : ''}</div>
                        <div style="margin-top: 2px; font-size: 6pt;"><b>Autonomie:</b> ${currentPole.conditionsExercice.autonomie}</div>
                    </div>
                </div>
                ` : ''}

                <!-- Résultats attendus -->
                ${currentPole?.resultatsAttendus ? `
                <div class="section">
                    <div class="section-title purple">🎯 Résultats attendus</div>
                    <div class="section-content">
                        ${selectedTache && currentPole.resultatsAttendus[selectedTache] ? `
                            <ul class="list-compact">
                                ${currentPole.resultatsAttendus[selectedTache].slice(0, 3).map(r => `<li>${r}</li>`).join('')}
                            </ul>
                        ` : Object.entries(currentPole.resultatsAttendus).slice(0, 2).map(([tacheId, resultats]) => `
                            <div><b style="font-size: 6pt;">${tacheId}:</b> ${resultats.slice(0, 2).join('; ')}${resultats.length > 2 ? '...' : ''}</div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}

                <!-- Compétences mobilisées -->
                <div class="section">
                    <div class="section-title orange">⚡ Compétences</div>
                    <div class="section-content">
                        ${availableCompetences.slice(0, 3).map(comp => `
                            <div class="competence-mini">
                                <div class="competence-mini-title">${comp.id} - ${comp.nom}</div>
                                <div style="font-size: 6pt; color: #64748b;">${comp.connaissances.slice(0, 3).map(c => `${c.nom}(N${c.niveau})`).join(', ')}</div>
                                <div class="criteres-list">${comp.criteres.slice(0, 2).join(' • ')}</div>
                            </div>
                        `).join('')}
                        ${availableCompetences.length > 3 ? `<div style="font-size: 6pt; color: #94a3b8;">+ ${availableCompetences.length - 3} autres compétences...</div>` : ''}
                    </div>
                </div>

                <!-- Connaissances globales -->
                ${savoirsSelectionnes.length > 0 ? `
                <div class="section">
                    <div class="section-title red">📚 Connaissances</div>
                    <div class="section-content">
                        ${savoirsSelectionnes.map(s => `<span class="savoir-item">${s.id}. ${s.nom}</span>`).join('')}
                    </div>
                </div>
                ` : ''}
            </div>

            <!-- COLONNE DROITE : CONSTRUCTION DE LA SÉANCE -->
            <div class="column column-right">
                <div class="column-title">✏️ CONSTRUCTION DE LA SÉANCE</div>
                
                <!-- En-tête séance -->
                <div class="seance-header">
                    ${seanceNumero ? `<div class="numero">SÉANCE N° ${seanceNumero}</div>` : '<div class="numero">SÉANCE</div>'}
                    ${seanceTitre ? `<div class="titre">${seanceTitre}</div>` : ''}
                </div>

                <!-- ON DONNE -->
                <div class="section flex-1">
                    <div class="section-title gray">📄 ON DONNE</div>
                    <div class="section-content scrollable">
                        ${Object.keys(documentsParCategorie).length > 0 ? 
                          Object.entries(documentsParCategorie).map(([category, docs]) => `
                            <div class="on-donne-category">
                                <div class="on-donne-category-title">${category}</div>
                                ${docs.map(doc => `
                                    <div class="on-donne-item">
                                        ✓ ${doc.nom}${doc.detail ? ` <span class="on-donne-detail">— ${doc.detail}</span>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                          `).join('') 
                        : '<p style="color: #94a3b8; font-style: italic; font-size: 6pt;">Aucun document</p>'}
                    </div>
                </div>

                <!-- ON DEMANDE -->
                <div class="section flex-1">
                    <div class="section-title gray">❓ ON DEMANDE</div>
                    <div class="on-demande-box">
                        ${(() => {
                          // Collecter tous les attendus sélectionnés
                          const attendusSelectionnes = [];
                          
                          // Attendus du référentiel
                          Object.entries(selectedAttendus).filter(([k, v]) => v).forEach(([key]) => {
                            const text = customAttendus[key] || '';
                            if (text) attendusSelectionnes.push(text);
                          });
                          
                          // Attendus personnalisés
                          customOnDemande.filter(item => item.selected && item.text).forEach(item => {
                            attendusSelectionnes.push(item.text);
                          });
                          
                          if (attendusSelectionnes.length === 0 && !onDemande) {
                            return '<span style="color: #94a3b8; font-style: italic;">Travail à réaliser...</span>';
                          }
                          
                          let html = '';
                          if (attendusSelectionnes.length > 0) {
                            html += '<ul style="margin: 0; padding-left: 4mm; list-style-type: disc;">';
                            attendusSelectionnes.forEach(text => {
                              html += '<li style="margin-bottom: 1mm; font-size: 7.5pt; line-height: 1.3;">' + text + '</li>';
                            });
                            html += '</ul>';
                          }
                          if (onDemande) {
                            if (attendusSelectionnes.length > 0) {
                              html += '<div style="margin-top: 2mm; padding-top: 2mm; border-top: 0.3mm dashed #cbd5e1;">';
                            }
                            html += '<div style="font-size: 7pt; color: #64748b; white-space: pre-wrap;">' + onDemande + '</div>';
                            if (attendusSelectionnes.length > 0) {
                              html += '</div>';
                            }
                          }
                          return html;
                        })()}
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            BTS Bâtiment - Fiche de séance - ${new Date().toLocaleDateString('fr-FR')}
        </div>
    </div>
</body>
</html>
    `;

    printWindow.document.write(htmlContent);
    printWindow.document.close();
    printWindow.onload = () => {
      printWindow.print();
    };
  };

  // Toggle un moyen dans "On donne"
  const toggleOnDonne = (moyen) => {
    setOnDonne(prev => ({
      ...prev,
      [moyen]: !prev[moyen]
    }));
  };

  // Mettre à jour le détail d'un moyen
  const updateOnDonneDetail = (moyen, detail) => {
    setOnDonneDetails(prev => ({
      ...prev,
      [moyen]: detail
    }));
  };

  // Toggle une catégorie (déplier/replier)
  const toggleCategory = (category) => {
    setExpandedCategories(prev => ({
      ...prev,
      [category]: !prev[category]
    }));
  };

  // Ajouter un champ personnalisé à une catégorie
  const addCustomField = (category) => {
    const newField = { id: Date.now(), nom: '', detail: '' };
    setCustomFields(prev => ({
      ...prev,
      [category]: [...(prev[category] || []), newField]
    }));
  };

  // Mettre à jour un champ personnalisé
  const updateCustomField = (category, fieldId, key, value) => {
    setCustomFields(prev => ({
      ...prev,
      [category]: (prev[category] || []).map(field => 
        field.id === fieldId ? { ...field, [key]: value } : field
      )
    }));
  };

  // Supprimer un champ personnalisé
  const removeCustomField = (category, fieldId) => {
    setCustomFields(prev => ({
      ...prev,
      [category]: (prev[category] || []).filter(field => field.id !== fieldId)
    }));
  };

  // Fonction pour rendre les items d'une catégorie (récursif pour sous-catégories)
  const renderCategoryItems = (items, categoryPath) => {
    if (Array.isArray(items)) {
      return items.map((item, idx) => {
        const itemKey = `${categoryPath}::${item}`;
        return (
          <div key={idx} style={{ marginBottom: '10px' }}>
            <label style={{ 
              display: 'flex', 
              alignItems: 'flex-start', 
              gap: '10px',
              cursor: 'pointer',
              padding: '8px',
              borderRadius: '6px',
              background: onDonne[itemKey] ? 'rgba(96, 165, 250, 0.1)' : 'transparent',
              border: onDonne[itemKey] ? '1px solid rgba(96, 165, 250, 0.3)' : '1px solid transparent',
              transition: 'all 0.2s ease'
            }}>
              <input
                type="checkbox"
                checked={onDonne[itemKey] || false}
                onChange={() => toggleOnDonne(itemKey)}
                style={{ 
                  width: '18px', 
                  height: '18px', 
                  marginTop: '2px',
                  accentColor: '#60a5fa'
                }}
              />
              <span style={{ color: '#e2e8f0', fontSize: '13px' }}>{item}</span>
            </label>
            {onDonne[itemKey] && (
              <input
                type="text"
                value={onDonneDetails[itemKey] || ''}
                onChange={(e) => updateOnDonneDetail(itemKey, e.target.value)}
                placeholder="Précisions (ex: pages 1-5, version du 12/01...)"
                style={{
                  width: 'calc(100% - 28px)',
                  marginLeft: '28px',
                  marginTop: '6px',
                  padding: '8px 12px',
                  background: 'rgba(30, 41, 59, 0.8)',
                  border: '1px solid rgba(96, 165, 250, 0.3)',
                  borderRadius: '6px',
                  color: '#e2e8f0',
                  fontSize: '12px'
                }}
              />
            )}
          </div>
        );
      });
    } else if (typeof items === 'object') {
      // Sous-catégories
      return Object.entries(items).map(([subCat, subItems]) => (
        <div key={subCat} style={{ 
          marginBottom: '12px',
          marginLeft: '12px',
          paddingLeft: '12px',
          borderLeft: '2px solid rgba(148, 163, 184, 0.2)'
        }}>
          <div style={{ 
            color: '#94a3b8', 
            fontSize: '12px', 
            fontWeight: 600,
            marginBottom: '8px',
            textTransform: 'uppercase',
            letterSpacing: '0.5px'
          }}>
            {subCat}
          </div>
          {renderCategoryItems(subItems, `${categoryPath}::${subCat}`)}
        </div>
      ));
    }
    return null;
  };

  return (
    <div style={{
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)',
      fontFamily: "'Instrument Sans', 'SF Pro Display', -apple-system, sans-serif",
      color: '#e2e8f0',
      padding: '2rem'
    }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * { box-sizing: border-box; }
        
        .glass-card {
          background: rgba(30, 41, 59, 0.6);
          backdrop-filter: blur(20px);
          border: 1px solid rgba(148, 163, 184, 0.1);
          border-radius: 20px;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
          border-color: rgba(251, 191, 36, 0.3);
          box-shadow: 0 0 40px rgba(251, 191, 36, 0.1);
        }
        
        .select-wrapper {
          position: relative;
        }
        
        .select-wrapper::after {
          content: '▼';
          position: absolute;
          right: 16px;
          top: 50%;
          transform: translateY(-50%);
          color: #fbbf24;
          font-size: 10px;
          pointer-events: none;
        }
        
        select {
          appearance: none;
          width: 100%;
          padding: 14px 40px 14px 16px;
          background: rgba(15, 23, 42, 0.8);
          border: 2px solid rgba(148, 163, 184, 0.2);
          border-radius: 12px;
          color: #e2e8f0;
          font-size: 14px;
          font-family: inherit;
          cursor: pointer;
          transition: all 0.2s ease;
        }
        
        select:hover {
          border-color: rgba(251, 191, 36, 0.5);
        }
        
        select:focus {
          outline: none;
          border-color: #fbbf24;
          box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.2);
        }
        
        select option {
          background: #1e293b;
          color: #e2e8f0;
          padding: 12px;
        }
        
        .tag {
          display: inline-flex;
          align-items: center;
          padding: 6px 12px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
          font-family: 'JetBrains Mono', monospace;
          letter-spacing: 0.5px;
        }
        
        .niveau-1 { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); }
        .niveau-2 { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); }
        .niveau-3 { background: rgba(168, 85, 247, 0.2); color: #c084fc; border: 1px solid rgba(168, 85, 247, 0.3); }
        .niveau-4 { background: rgba(251, 191, 36, 0.2); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); }
        
        .btn-mode {
          padding: 10px 20px;
          border: 2px solid transparent;
          border-radius: 10px;
          font-size: 13px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s ease;
          background: rgba(30, 41, 59, 0.6);
          color: #94a3b8;
        }
        
        .btn-mode:hover {
          background: rgba(30, 41, 59, 0.9);
          color: #e2e8f0;
        }
        
        .btn-mode.active {
          background: linear-gradient(135deg, #fbbf24, #f59e0b);
          color: #0f172a;
          border-color: #fbbf24;
        }
        
        .btn-reset {
          padding: 12px 24px;
          background: transparent;
          border: 2px solid rgba(239, 68, 68, 0.5);
          border-radius: 10px;
          color: #ef4444;
          font-size: 13px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s ease;
        }
        
        .btn-reset:hover {
          background: rgba(239, 68, 68, 0.1);
          border-color: #ef4444;
        }
        
        .result-card {
          background: rgba(15, 23, 42, 0.6);
          border: 1px solid rgba(148, 163, 184, 0.1);
          border-radius: 16px;
          padding: 20px;
          margin-bottom: 16px;
          transition: all 0.2s ease;
        }
        
        .result-card:hover {
          transform: translateX(8px);
          border-color: rgba(251, 191, 36, 0.3);
        }
        
        .critere-item {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          padding: 12px 16px;
          background: rgba(30, 41, 59, 0.4);
          border-radius: 10px;
          margin-bottom: 8px;
          border-left: 3px solid #fbbf24;
        }
        
        .critere-check {
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: linear-gradient(135deg, #fbbf24, #f59e0b);
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
          margin-top: 2px;
        }
        
        .animate-in {
          animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .header-decoration {
          position: absolute;
          top: -2px;
          left: 50%;
          transform: translateX(-50%);
          width: 100px;
          height: 4px;
          background: linear-gradient(90deg, transparent, #fbbf24, transparent);
          border-radius: 2px;
        }
        
        .glow-text {
          text-shadow: 0 0 40px rgba(251, 191, 36, 0.3);
        }

        .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: #64748b;
        }
        
        .empty-state svg {
          width: 80px;
          height: 80px;
          margin-bottom: 20px;
          opacity: 0.5;
        }
      `}</style>

      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        {/* Header */}
        <div className="glass-card" style={{ 
          padding: '40px', 
          marginBottom: '24px',
          position: 'relative',
          overflow: 'hidden'
        }}>
          <div className="header-decoration" />
          <div style={{ 
            position: 'absolute',
            top: 0,
            right: 0,
            width: '300px',
            height: '300px',
            background: 'radial-gradient(circle, rgba(251, 191, 36, 0.1) 0%, transparent 70%)',
            pointerEvents: 'none'
          }} />
          
          <h1 className="glow-text" style={{ 
            fontSize: '2.5rem', 
            fontWeight: 700, 
            marginBottom: '12px',
            background: 'linear-gradient(135deg, #fbbf24, #f59e0b, #fbbf24)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            letterSpacing: '-0.5px'
          }}>
            Référentiel BTS Bâtiment
          </h1>
          <p style={{ 
            color: '#94a3b8', 
            fontSize: '1.1rem',
            maxWidth: '600px'
          }}>
            Explorateur interactif du référentiel de compétences
            <span style={{ 
              display: 'inline-block',
              marginLeft: '12px',
              padding: '4px 10px',
              background: 'rgba(251, 191, 36, 0.15)',
              borderRadius: '6px',
              fontSize: '12px',
              color: '#fbbf24',
              fontFamily: "'JetBrains Mono', monospace"
            }}>
              4 Blocs • 15 Compétences
            </span>
          </p>
          <p style={{
            position: 'absolute',
            bottom: '16px',
            right: '24px',
            fontSize: '11px',
            fontStyle: 'italic',
            color: '#64748b',
            margin: 0
          }}>
            Jean-Philippe Amat — v1.4 — 2026
          </p>
        </div>

        {/* Mode Toggle & Reset */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between', 
          alignItems: 'center',
          marginBottom: '24px',
          flexWrap: 'wrap',
          gap: '16px'
        }}>
          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
            <button 
              className={`btn-mode ${viewMode === 'competences' ? 'active' : ''}`}
              onClick={() => setViewMode('competences')}
            >
              ◇ Bloc de compétences
            </button>
            <button 
              className={`btn-mode ${viewMode === 'tableau' ? 'active' : ''}`}
              onClick={() => setViewMode('tableau')}
            >
              ▦ Tâches / Compétences
            </button>
            <button 
              className={`btn-mode ${viewMode === 'connaissances' ? 'active' : ''}`}
              onClick={() => setViewMode('connaissances')}
            >
              ▤ Connaissances / Compétences
            </button>
          </div>
          
          <button className="btn-reset" onClick={resetFilters}>
            ↺ Réinitialiser les filtres
          </button>
        </div>

        {/* Filters */}
        <div className="glass-card animate-in" style={{ padding: '32px', marginBottom: '24px' }}>
          <h2 style={{ 
            fontSize: '1rem', 
            fontWeight: 600, 
            marginBottom: '24px',
            color: '#fbbf24',
            textTransform: 'uppercase',
            letterSpacing: '2px',
            display: 'flex',
            alignItems: 'center',
            gap: '10px'
          }}>
            <span style={{ 
              width: '8px', 
              height: '8px', 
              background: '#fbbf24', 
              borderRadius: '2px' 
            }} />
            Filtres conditionnels
          </h2>
          
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', 
            gap: '20px' 
          }}>
            {/* Bloc Filter */}
            <div>
              <label style={{ 
                display: 'block', 
                marginBottom: '8px', 
                color: '#94a3b8',
                fontSize: '13px',
                fontWeight: 500
              }}>
                Bloc de compétences
              </label>
              <div className="select-wrapper">
                <select value={selectedBloc || ''} onChange={(e) => handleBlocChange(e.target.value)}>
                  <option value="">Tous les blocs</option>
                  {data.blocs.map(bloc => (
                    <option key={bloc.id} value={bloc.id}>
                      Bloc {bloc.id} ({bloc.unite}) — {bloc.nom}
                    </option>
                  ))}
                </select>
              </div>
            </div>

            {/* Pole Filter - Conditional */}
            {selectedBloc && (
              <div className="animate-in">
                <label style={{ 
                  display: 'block', 
                  marginBottom: '8px', 
                  color: '#94a3b8',
                  fontSize: '13px',
                  fontWeight: 500
                }}>
                  Pôle d'activité
                </label>
                <div className="select-wrapper">
                  <select value={selectedPole || ''} onChange={(e) => handlePoleChange(e.target.value)}>
                    <option value="">Tous les pôles</option>
                    {currentBloc?.poles.map(pole => (
                      <option key={pole.id} value={pole.id}>
                        {pole.id} — {pole.nom}
                      </option>
                    ))}
                  </select>
                </div>
              </div>
            )}

            {/* Tache Filter - Conditional */}
            {selectedPole && (
              <div className="animate-in">
                <label style={{ 
                  display: 'block', 
                  marginBottom: '8px', 
                  color: '#94a3b8',
                  fontSize: '13px',
                  fontWeight: 500
                }}>
                  Tâche professionnelle
                </label>
                <div className="select-wrapper">
                  <select value={selectedTache || ''} onChange={(e) => handleTacheChange(e.target.value)}>
                    <option value="">Toutes les tâches</option>
                    {currentPole?.taches.map(tache => (
                      <option key={tache.id} value={tache.id}>
                        {tache.id} — {tache.nom}
                      </option>
                    ))}
                  </select>
                </div>
              </div>
            )}

            {/* Competence Filter - Conditional based on task selection */}
            {selectedBloc && (
              <div className="animate-in">
                <label style={{ 
                  display: 'block', 
                  marginBottom: '8px', 
                  color: '#94a3b8',
                  fontSize: '13px',
                  fontWeight: 500
                }}>
                  Compétence
                  {selectedTache && (
                    <span style={{ 
                      marginLeft: '8px',
                      fontSize: '11px',
                      color: '#fbbf24',
                      fontStyle: 'italic'
                    }}>
                      (filtrée selon {selectedTache})
                    </span>
                  )}
                </label>
                <div className="select-wrapper">
                  <select value={selectedCompetence || ''} onChange={(e) => handleCompetenceChange(e.target.value)}>
                    <option value="">{selectedTache ? `Compétences de ${selectedTache}` : 'Toutes les compétences'}</option>
                    {availableCompetences.map(comp => (
                      <option key={comp.id} value={comp.id}>
                        {comp.id} — {comp.nom}
                      </option>
                    ))}
                  </select>
                </div>
              </div>
            )}
          </div>

          {/* Message d'indication si tous les champs ne sont pas renseignés */}
          {selectedBloc && !(selectedPole && selectedTache && selectedCompetence) && (
            <div style={{ marginTop: '24px', paddingTop: '24px', borderTop: '1px solid rgba(148, 163, 184, 0.2)' }}>
              <div style={{
                background: 'rgba(245, 158, 11, 0.1)',
                border: '1px solid rgba(245, 158, 11, 0.3)',
                borderRadius: '8px',
                padding: '16px',
                textAlign: 'center'
              }}>
                <span style={{ color: '#f59e0b', fontSize: '14px' }}>
                  💡 Renseignez tous les filtres (Bloc, Pôle, Tâche et Compétence) pour accéder à la création de séance
                </span>
              </div>
            </div>
          )}
        </div>

        {/* TABLEAU TÂCHES / COMPÉTENCES */}
        {viewMode === 'tableau' && (
          <div className="glass-card" style={{ padding: '32px', marginTop: '24px' }}>
            <h2 style={{ 
              fontSize: '1.1rem', 
              fontWeight: 700, 
              color: '#fbbf24',
              marginBottom: '24px',
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              <span style={{ fontSize: '22px' }}>▦</span>
              Tableau croisé Tâches / Compétences
            </h2>
            <div style={{ overflowX: 'auto' }}>
              <table style={{ 
                width: '100%', 
                borderCollapse: 'collapse',
                fontSize: '12px'
              }}>
                <thead>
                  <tr>
                    <th style={{ 
                      background: 'rgba(30, 41, 59, 0.8)',
                      padding: '12px 8px',
                      textAlign: 'left',
                      borderBottom: '2px solid #fbbf24',
                      position: 'sticky',
                      left: 0,
                      zIndex: 2,
                      minWidth: '200px'
                    }}>
                      Tâches professionnelles
                    </th>
                    {data.blocs.map(bloc => (
                      <th 
                        key={bloc.id} 
                        colSpan={bloc.competences.length}
                        style={{ 
                          background: 'rgba(251, 191, 36, 0.2)',
                          padding: '8px',
                          textAlign: 'center',
                          borderBottom: '2px solid #fbbf24',
                          borderLeft: '2px solid rgba(148, 163, 184, 0.3)'
                        }}
                      >
                        <div style={{ fontWeight: 600, fontSize: '11px' }}>Bloc {bloc.id} - {bloc.nom}</div>
                      </th>
                    ))}
                  </tr>
                  <tr>
                    <th style={{ 
                      background: 'rgba(30, 41, 59, 0.8)',
                      padding: '8px',
                      borderBottom: '1px solid rgba(148, 163, 184, 0.2)',
                      position: 'sticky',
                      left: 0,
                      zIndex: 2
                    }}></th>
                    {data.blocs.flatMap(bloc => 
                      bloc.competences.map((comp, idx) => (
                        <th 
                          key={comp.id}
                          style={{ 
                            background: 'rgba(30, 41, 59, 0.6)',
                            padding: '8px 4px',
                            textAlign: 'center',
                            borderBottom: '1px solid rgba(148, 163, 184, 0.2)',
                            borderLeft: idx === 0 ? '2px solid rgba(148, 163, 184, 0.3)' : '1px solid rgba(148, 163, 184, 0.1)',
                            minWidth: '45px'
                          }}
                          title={comp.nom}
                        >
                          <span style={{ 
                            color: '#fbbf24', 
                            fontWeight: 700,
                            fontSize: '11px'
                          }}>
                            {comp.id}
                          </span>
                        </th>
                      ))
                    )}
                  </tr>
                </thead>
                <tbody>
                  {data.blocs.map(bloc => (
                    <React.Fragment key={bloc.id}>
                      {bloc.poles.map(pole => (
                        <React.Fragment key={pole.id}>
                          <tr>
                            <td 
                              colSpan={1 + data.blocs.reduce((acc, b) => acc + b.competences.length, 0)}
                              style={{
                                background: 'rgba(167, 139, 250, 0.15)',
                                padding: '8px 12px',
                                fontWeight: 600,
                                color: '#a78bfa',
                                fontSize: '11px'
                              }}
                            >
                              {pole.id} — {pole.nom}
                            </td>
                          </tr>
                          {pole.taches.map(tache => (
                            <tr key={tache.id}>
                              <td style={{
                                background: 'rgba(30, 41, 59, 0.4)',
                                padding: '8px 12px',
                                borderBottom: '1px solid rgba(148, 163, 184, 0.1)',
                                position: 'sticky',
                                left: 0,
                                zIndex: 1,
                                fontSize: '11px'
                              }}>
                                <span style={{ color: '#ec4899', fontWeight: 600, marginRight: '8px' }}>{tache.id}</span>
                                <span style={{ color: '#e2e8f0' }}>{tache.nom}</span>
                              </td>
                              {data.blocs.flatMap(b => 
                                b.competences.map((comp, idx) => (
                                  <td 
                                    key={comp.id}
                                    style={{
                                      textAlign: 'center',
                                      padding: '8px',
                                      borderBottom: '1px solid rgba(148, 163, 184, 0.1)',
                                      borderLeft: idx === 0 ? '2px solid rgba(148, 163, 184, 0.3)' : '1px solid rgba(148, 163, 184, 0.1)'
                                    }}
                                  >
                                    {tache.competences?.includes(comp.id) && (
                                      <span style={{ 
                                        display: 'inline-block',
                                        width: '20px',
                                        height: '20px',
                                        background: 'linear-gradient(135deg, #fbbf24, #f59e0b)',
                                        borderRadius: '4px',
                                        color: '#0f172a',
                                        fontWeight: 700,
                                        fontSize: '12px',
                                        lineHeight: '20px'
                                      }}>
                                        ✓
                                      </span>
                                    )}
                                  </td>
                                ))
                              )}
                            </tr>
                          ))}
                        </React.Fragment>
                      ))}
                    </React.Fragment>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* TABLEAU CONNAISSANCES / COMPÉTENCES */}
        {viewMode === 'connaissances' && (
          <div className="glass-card" style={{ padding: '32px', marginTop: '24px' }}>
            <h2 style={{ 
              fontSize: '1.1rem', 
              fontWeight: 700, 
              color: '#4ade80',
              marginBottom: '24px',
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              <span style={{ fontSize: '22px' }}>▤</span>
              Tableau croisé Connaissances / Compétences
            </h2>
            <div style={{ overflowX: 'auto' }}>
              <table style={{ 
                width: '100%', 
                borderCollapse: 'collapse',
                fontSize: '12px'
              }}>
                <thead>
                  <tr>
                    <th style={{ 
                      background: 'rgba(30, 41, 59, 0.8)',
                      padding: '12px 8px',
                      textAlign: 'left',
                      borderBottom: '2px solid #4ade80',
                      position: 'sticky',
                      left: 0,
                      zIndex: 2,
                      minWidth: '250px'
                    }}>
                      Connaissances globales
                    </th>
                    {data.blocs.map(bloc => (
                      <th 
                        key={bloc.id} 
                        colSpan={bloc.competences.length}
                        style={{ 
                          background: 'rgba(74, 222, 128, 0.2)',
                          padding: '8px',
                          textAlign: 'center',
                          borderBottom: '2px solid #4ade80',
                          borderLeft: '2px solid rgba(148, 163, 184, 0.3)'
                        }}
                      >
                        <div style={{ fontWeight: 600, fontSize: '11px' }}>Bloc {bloc.id} - {bloc.nom}</div>
                      </th>
                    ))}
                  </tr>
                  <tr>
                    <th style={{ 
                      background: 'rgba(30, 41, 59, 0.8)',
                      padding: '8px',
                      borderBottom: '1px solid rgba(148, 163, 184, 0.2)',
                      position: 'sticky',
                      left: 0,
                      zIndex: 2
                    }}></th>
                    {data.blocs.flatMap(bloc => 
                      bloc.competences.map((comp, idx) => (
                        <th 
                          key={comp.id}
                          style={{ 
                            background: 'rgba(30, 41, 59, 0.6)',
                            padding: '8px 4px',
                            textAlign: 'center',
                            borderBottom: '1px solid rgba(148, 163, 184, 0.2)',
                            borderLeft: idx === 0 ? '2px solid rgba(148, 163, 184, 0.3)' : '1px solid rgba(148, 163, 184, 0.1)',
                            minWidth: '45px'
                          }}
                          title={comp.nom}
                        >
                          <span style={{ 
                            color: '#fbbf24', 
                            fontWeight: 700,
                            fontSize: '11px'
                          }}>
                            {comp.id}
                          </span>
                        </th>
                      ))
                    )}
                  </tr>
                </thead>
                <tbody>
                  {connaissancesGlobales.map(conn => (
                    <tr key={conn.id}>
                      <td style={{ 
                        background: 'rgba(30, 41, 59, 0.4)',
                        padding: '10px 12px',
                        borderBottom: '1px solid rgba(148, 163, 184, 0.1)',
                        position: 'sticky',
                        left: 0,
                        zIndex: 1
                      }}>
                        <span style={{ 
                          color: '#4ade80', 
                          fontWeight: 600, 
                          marginRight: '10px',
                          fontFamily: "'JetBrains Mono', monospace"
                        }}>
                          {conn.id}
                        </span>
                        <span style={{ color: '#e2e8f0' }}>{conn.nom}</span>
                      </td>
                      {data.blocs.flatMap(bloc => 
                        bloc.competences.map((comp, idx) => {
                          const isLinked = conn.competences.includes(comp.id);
                          const niveau = isLinked ? comp.connaissances.find(c => c.nom === conn.nom)?.niveau : null;
                          return (
                            <td 
                              key={comp.id}
                              style={{
                                textAlign: 'center',
                                padding: '8px',
                                borderBottom: '1px solid rgba(148, 163, 184, 0.1)',
                                borderLeft: idx === 0 ? '2px solid rgba(148, 163, 184, 0.3)' : '1px solid rgba(148, 163, 184, 0.1)',
                                background: isLinked ? 'rgba(74, 222, 128, 0.1)' : 'transparent'
                              }}
                            >
                              {isLinked && (
                                <span style={{ 
                                  display: 'inline-block',
                                  minWidth: '24px',
                                  padding: '2px 6px',
                                  background: niveau ? `rgba(${niveau === 4 ? '251, 191, 36' : niveau === 3 ? '168, 85, 247' : niveau === 2 ? '59, 130, 246' : '34, 197, 94'}, 0.3)` : 'rgba(74, 222, 128, 0.3)',
                                  borderRadius: '4px',
                                  color: niveau ? (niveau === 4 ? '#fbbf24' : niveau === 3 ? '#c084fc' : niveau === 2 ? '#60a5fa' : '#4ade80') : '#4ade80',
                                  fontWeight: 700,
                                  fontSize: '10px'
                                }}>
                                  {niveau ? `N${niveau}` : '✓'}
                                </span>
                              )}
                            </td>
                          );
                        })
                      )}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        )}


        {/* RÉCAPITULATIF DU CONTEXTE (visible si tous les filtres sont renseignés) */}
        {selectedBloc && selectedPole && selectedTache && selectedCompetence && (
          <div className="glass-card" style={{ padding: '32px', marginTop: '24px' }}>
            <h2 style={{ 
              fontSize: '1.1rem', 
              fontWeight: 700, 
              color: '#60a5fa',
              marginBottom: '24px',
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              <span style={{ fontSize: '22px' }}>📋</span>
              Récapitulatif du contexte sélectionné
            </h2>

            {/* Bloc et Unité */}
            <div style={{ 
              display: 'grid', 
              gridTemplateColumns: 'repeat(2, 1fr)', 
              gap: '16px',
              marginBottom: '20px'
            }}>
              <div style={{
                background: 'rgba(251, 191, 36, 0.1)',
                border: '1px solid rgba(251, 191, 36, 0.3)',
                borderRadius: '10px',
                padding: '16px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>
                  Bloc de compétences
                </div>
                <div style={{ color: '#fbbf24', fontWeight: 600, fontSize: '14px' }}>
                  {currentBloc?.nom}
                </div>
                <div style={{ color: '#94a3b8', fontSize: '12px', marginTop: '4px' }}>
                  Unité {currentBloc?.unite}
                </div>
              </div>

              <div style={{
                background: 'rgba(167, 139, 250, 0.1)',
                border: '1px solid rgba(167, 139, 250, 0.3)',
                borderRadius: '10px',
                padding: '16px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>
                  Pôle d'activités
                </div>
                <div style={{ color: '#a78bfa', fontWeight: 600, fontSize: '14px' }}>
                  {selectedPole} — {currentPole?.nom}
                </div>
                <div style={{ color: '#94a3b8', fontSize: '12px', marginTop: '4px' }}>
                  Autonomie : {currentPole?.conditionsExercice?.autonomie || 'Non spécifiée'}
                </div>
              </div>
            </div>

            {/* Tâche et Compétence */}
            <div style={{ 
              display: 'grid', 
              gridTemplateColumns: 'repeat(2, 1fr)', 
              gap: '16px',
              marginBottom: '20px'
            }}>
              <div style={{
                background: 'rgba(236, 72, 153, 0.1)',
                border: '1px solid rgba(236, 72, 153, 0.3)',
                borderRadius: '10px',
                padding: '16px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>
                  Tâche professionnelle
                </div>
                <div style={{ color: '#ec4899', fontWeight: 600, fontSize: '14px' }}>
                  {selectedTache} — {currentTache?.nom}
                </div>
              </div>

              <div style={{
                background: 'rgba(251, 191, 36, 0.1)',
                border: '1px solid rgba(251, 191, 36, 0.3)',
                borderRadius: '10px',
                padding: '16px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '8px' }}>
                  Compétence visée
                </div>
                <div style={{ color: '#fbbf24', fontWeight: 600, fontSize: '14px' }}>
                  {selectedCompetence} — {currentCompetence?.nom}
                </div>
              </div>
            </div>

            {/* Connaissances associées à la compétence */}
            {currentCompetence?.connaissances && currentCompetence.connaissances.length > 0 && (
              <div style={{
                background: 'rgba(74, 222, 128, 0.1)',
                border: '1px solid rgba(74, 222, 128, 0.3)',
                borderRadius: '10px',
                padding: '16px',
                marginBottom: '20px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px' }}>
                  📚 Connaissances associées à la compétence
                </div>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '10px' }}>
                  {currentCompetence.connaissances.map((conn, i) => (
                    <div key={i} style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      background: 'rgba(30, 41, 59, 0.6)',
                      padding: '8px 12px',
                      borderRadius: '8px'
                    }}>
                      <span style={{ color: '#4ade80', fontSize: '13px' }}>{conn.nom}</span>
                      <span style={{
                        background: `rgba(${conn.niveau === 4 ? '239, 68, 68' : conn.niveau === 3 ? '251, 191, 36' : conn.niveau === 2 ? '96, 165, 250' : '74, 222, 128'}, 0.3)`,
                        color: conn.niveau === 4 ? '#ef4444' : conn.niveau === 3 ? '#fbbf24' : conn.niveau === 2 ? '#60a5fa' : '#4ade80',
                        padding: '2px 8px',
                        borderRadius: '4px',
                        fontSize: '10px',
                        fontWeight: 600
                      }}>
                        N{conn.niveau}
                      </span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Critères d'évaluation */}
            {currentCompetence?.criteres && currentCompetence.criteres.length > 0 && (
              <div style={{
                background: 'rgba(6, 182, 212, 0.1)',
                border: '1px solid rgba(6, 182, 212, 0.3)',
                borderRadius: '10px',
                padding: '16px',
                marginBottom: '20px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px' }}>
                  ✓ Critères d'évaluation de la compétence
                </div>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {currentCompetence.criteres.map((critere, i) => (
                    <div key={i} style={{
                      display: 'flex',
                      alignItems: 'flex-start',
                      gap: '10px',
                      padding: '8px 12px',
                      background: 'rgba(30, 41, 59, 0.4)',
                      borderRadius: '6px'
                    }}>
                      <span style={{
                        color: '#06b6d4',
                        fontSize: '14px',
                        marginTop: '1px'
                      }}>•</span>
                      <span style={{ color: '#e2e8f0', fontSize: '13px', lineHeight: '1.4' }}>{critere}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Résultats attendus de la tâche */}
            {currentPole?.resultatsAttendus?.[selectedTache] && (
              <div style={{
                background: 'rgba(245, 158, 11, 0.1)',
                border: '1px solid rgba(245, 158, 11, 0.3)',
                borderRadius: '10px',
                padding: '16px',
                marginBottom: '20px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px' }}>
                  🎯 Résultats attendus de la tâche {selectedTache} <span style={{ fontStyle: 'italic', textTransform: 'none', fontSize: '10px' }}>(formulés à l'indicatif)</span>
                </div>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                  {currentPole.resultatsAttendus[selectedTache].map((resultat, i) => (
                    <div key={i} style={{
                      display: 'flex',
                      alignItems: 'flex-start',
                      gap: '10px',
                      padding: '8px 12px',
                      background: 'rgba(30, 41, 59, 0.4)',
                      borderRadius: '6px'
                    }}>
                      <span style={{
                        color: '#f59e0b',
                        fontSize: '14px',
                        marginTop: '1px'
                      }}>•</span>
                      <span style={{ color: '#e2e8f0', fontSize: '13px', lineHeight: '1.4' }}>{transformerEnIndicatif(resultat)}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Moyens / Ressources du pôle */}
            {currentPole?.conditionsExercice?.moyens && currentPole.conditionsExercice.moyens.length > 0 && (
              <div style={{
                background: 'rgba(96, 165, 250, 0.1)',
                border: '1px solid rgba(96, 165, 250, 0.3)',
                borderRadius: '10px',
                padding: '16px'
              }}>
                <div style={{ color: '#94a3b8', fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '12px' }}>
                  📂 Moyens et ressources disponibles (conditions d'exercice)
                </div>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                  {currentPole.conditionsExercice.moyens.map((moyen, i) => (
                    <span key={i} style={{
                      background: 'rgba(30, 41, 59, 0.6)',
                      padding: '6px 12px',
                      borderRadius: '6px',
                      color: '#60a5fa',
                      fontSize: '12px'
                    }}>
                      {moyen}
                    </span>
                  ))}
                </div>
              </div>
            )}
          </div>
        )}

        {/* MODE ÉDITION - FICHE DE SÉANCE (en bas de page, visible si tous les filtres sont renseignés) */}
        {selectedBloc && selectedPole && selectedTache && selectedCompetence && (
          <div id="mode-edition-section" className="glass-card" style={{ padding: '32px', marginTop: '24px' }}>
            <div style={{ 
              display: 'flex', 
              justifyContent: 'space-between', 
              alignItems: 'center',
              marginBottom: '24px'
            }}>
              <h2 style={{ 
                fontSize: '1.2rem', 
                fontWeight: 700, 
                color: '#10b981',
                display: 'flex',
                alignItems: 'center',
                gap: '12px'
              }}>
                <span style={{ fontSize: '24px' }}>✏️</span>
                Mode Édition - Fiche de séance
              </h2>
              <button
                onClick={() => setEditMode(!editMode)}
                style={{
                  background: editMode ? 'rgba(239, 68, 68, 0.2)' : 'linear-gradient(135deg, #10b981, #059669)',
                  border: editMode ? '1px solid rgba(239, 68, 68, 0.3)' : 'none',
                  borderRadius: '10px',
                  color: editMode ? '#ef4444' : '#fff',
                  padding: '12px 24px',
                  cursor: 'pointer',
                  fontSize: '14px',
                  fontWeight: 600,
                  boxShadow: editMode ? 'none' : '0 4px 15px rgba(16, 185, 129, 0.3)',
                  transition: 'all 0.2s ease'
                }}
              >
                {editMode ? '✕ Fermer l\'édition' : '✎ Créer ma fiche de séance'}
              </button>
            </div>

            {!editMode && (
              <div style={{
                background: 'rgba(16, 185, 129, 0.05)',
                border: '1px dashed rgba(16, 185, 129, 0.3)',
                borderRadius: '12px',
                padding: '24px',
                textAlign: 'center'
              }}>
                <p style={{ color: '#94a3b8', fontSize: '14px' }}>
                  Cliquez sur le bouton ci-dessus pour ouvrir l'éditeur de fiche de séance
                </p>
              </div>
            )}

            {editMode && (
              <div>
                {/* Numéro et Titre de la séance */}
                <div style={{ 
                  display: 'grid', 
                  gridTemplateColumns: '150px 1fr', 
                  gap: '16px',
                  marginBottom: '24px'
                }}>
                  <div>
                    <label style={{ 
                      display: 'block', 
                      color: '#94a3b8', 
                      fontSize: '12px', 
                      marginBottom: '6px',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>N° Séance</label>
                    <input
                      type="text"
                      value={seanceNumero}
                      onChange={(e) => setSeanceNumero(e.target.value)}
                      placeholder="Ex: 1, 2.1..."
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: 'rgba(30, 41, 59, 0.8)',
                        border: '1px solid rgba(148, 163, 184, 0.3)',
                        borderRadius: '8px',
                        color: '#e2e8f0',
                        fontSize: '14px'
                      }}
                    />
                  </div>
                  <div>
                    <label style={{ 
                      display: 'block', 
                      color: '#94a3b8', 
                      fontSize: '12px', 
                      marginBottom: '6px',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>Titre de la séance</label>
                    <input
                      type="text"
                      value={seanceTitre}
                      onChange={(e) => setSeanceTitre(e.target.value)}
                      placeholder="Ex: Analyse du CCTP et des plans..."
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: 'rgba(30, 41, 59, 0.8)',
                        border: '1px solid rgba(148, 163, 184, 0.3)',
                        borderRadius: '8px',
                        color: '#e2e8f0',
                        fontSize: '14px'
                      }}
                    />
                  </div>
                </div>

                {/* ON DONNE */}
                <div style={{ marginBottom: '24px' }}>
                  <h4 style={{ 
                    color: '#60a5fa', 
                    fontSize: '14px', 
                    fontWeight: 600, 
                    marginBottom: '16px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <span>📂</span> ON DONNE (ressources documentaires)
                  </h4>
                  <div style={{
                    background: 'rgba(30, 41, 59, 0.5)',
                    borderRadius: '12px',
                    padding: '16px',
                    maxHeight: '400px',
                    overflowY: 'auto'
                  }}>
                    {Object.entries(ressourcesDocumentaires).map(([category, items]) => (
                      <div key={category} style={{ 
                        marginBottom: '12px',
                        border: '1px solid rgba(148, 163, 184, 0.2)',
                        borderRadius: '8px',
                        overflow: 'hidden'
                      }}>
                        <div 
                          onClick={() => toggleCategory(category)}
                          style={{ 
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            padding: '12px 16px',
                            background: 'rgba(96, 165, 250, 0.15)',
                            cursor: 'pointer',
                            userSelect: 'none'
                          }}
                        >
                          <span style={{ 
                            color: '#60a5fa', 
                            fontWeight: 600, 
                            fontSize: '13px'
                          }}>
                            {expandedCategories[category] ? '▼' : '▶'} {category}
                          </span>
                          <span style={{
                            color: '#94a3b8',
                            fontSize: '12px'
                          }}>
                            {Object.entries(onDonne).filter(([k, v]) => k.startsWith(category) && v).length} sélectionné(s)
                          </span>
                        </div>
                        
                        {expandedCategories[category] && (
                          <div style={{ padding: '12px' }}>
                            {renderCategoryItems(items, category)}
                            
                            {(customFields[category] || []).map(field => (
                              <div key={field.id} style={{ 
                                marginBottom: '10px',
                                padding: '10px',
                                background: 'rgba(16, 185, 129, 0.1)',
                                borderRadius: '6px',
                                border: '1px solid rgba(16, 185, 129, 0.3)'
                              }}>
                                <div style={{ display: 'flex', gap: '8px', alignItems: 'center', marginBottom: '8px' }}>
                                  <input
                                    type="checkbox"
                                    checked={onDonne[`${category}::custom::${field.id}`] || false}
                                    onChange={() => toggleOnDonne(`${category}::custom::${field.id}`)}
                                    style={{ width: '16px', height: '16px', accentColor: '#10b981' }}
                                  />
                                  <input
                                    type="text"
                                    value={field.nom}
                                    onChange={(e) => updateCustomField(category, field.id, 'nom', e.target.value)}
                                    placeholder="Nom du document personnalisé..."
                                    style={{
                                      flex: 1,
                                      padding: '8px 12px',
                                      background: 'rgba(30, 41, 59, 0.8)',
                                      border: '1px solid rgba(16, 185, 129, 0.3)',
                                      borderRadius: '6px',
                                      color: '#e2e8f0',
                                      fontSize: '13px'
                                    }}
                                  />
                                  <button
                                    onClick={() => removeCustomField(category, field.id)}
                                    style={{
                                      background: 'rgba(239, 68, 68, 0.2)',
                                      border: '1px solid rgba(239, 68, 68, 0.3)',
                                      borderRadius: '6px',
                                      color: '#ef4444',
                                      padding: '6px 10px',
                                      cursor: 'pointer',
                                      fontSize: '12px'
                                    }}
                                  >
                                    ✕
                                  </button>
                                </div>
                                {onDonne[`${category}::custom::${field.id}`] && (
                                  <input
                                    type="text"
                                    value={field.detail}
                                    onChange={(e) => updateCustomField(category, field.id, 'detail', e.target.value)}
                                    placeholder="Précisions..."
                                    style={{
                                      width: 'calc(100% - 24px)',
                                      marginLeft: '24px',
                                      padding: '8px 12px',
                                      background: 'rgba(30, 41, 59, 0.8)',
                                      border: '1px solid rgba(16, 185, 129, 0.3)',
                                      borderRadius: '6px',
                                      color: '#e2e8f0',
                                      fontSize: '12px'
                                    }}
                                  />
                                )}
                              </div>
                            ))}
                            
                            <button
                              onClick={() => addCustomField(category)}
                              style={{
                                width: '100%',
                                padding: '10px',
                                marginTop: '8px',
                                background: 'rgba(16, 185, 129, 0.1)',
                                border: '1px dashed rgba(16, 185, 129, 0.4)',
                                borderRadius: '6px',
                                color: '#10b981',
                                cursor: 'pointer',
                                fontSize: '13px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '6px'
                              }}
                            >
                              <span>+</span> Ajouter un document personnalisé
                            </button>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>

                {/* ON DEMANDE - Résultats attendus selon filtrage */}
                <div style={{ marginBottom: '24px' }}>
                  <h4 style={{ 
                    color: '#f59e0b', 
                    fontSize: '14px', 
                    fontWeight: 600, 
                    marginBottom: '16px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    <span>❓</span> ON DEMANDE (travail à réaliser par l'étudiant)
                  </h4>
                  
                  {currentPole && currentPole.resultatsAttendus && (
                    <div style={{
                      background: 'rgba(30, 41, 59, 0.5)',
                      borderRadius: '12px',
                      padding: '16px',
                      marginBottom: '16px',
                      border: '1px solid rgba(245, 158, 11, 0.2)'
                    }}>
                      <div style={{ 
                        color: '#94a3b8', 
                        fontSize: '12px', 
                        marginBottom: '12px',
                        fontStyle: 'italic'
                      }}>
                        📋 Résultats attendus du référentiel ({selectedTache}) - formulés à l'indicatif :
                      </div>
                      
                      {Object.entries(currentPole.resultatsAttendus)
                        .filter(([tacheId]) => tacheId === selectedTache)
                        .map(([tacheId, resultats]) => (
                          <div key={tacheId}>
                            {resultats.map((resultat, idx) => {
                              const attenduKey = `${tacheId}::${idx}`;
                              const isSelected = selectedAttendus[attenduKey];
                              const resultatIndicatif = transformerEnIndicatif(resultat);
                              const customText = customAttendus[attenduKey];
                              const hasCustom = customText && customText !== resultatIndicatif;
                              
                              return (
                                <div key={idx} style={{ 
                                  marginBottom: '10px',
                                  padding: '12px',
                                  background: isSelected ? 'rgba(245, 158, 11, 0.1)' : 'rgba(30, 41, 59, 0.3)',
                                  borderRadius: '8px',
                                  border: isSelected ? '1px solid rgba(245, 158, 11, 0.3)' : '1px solid transparent',
                                  transition: 'all 0.2s ease'
                                }}>
                                  <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                                    <input
                                      type="checkbox"
                                      checked={isSelected || false}
                                      onChange={() => {
                                        setSelectedAttendus(prev => ({
                                          ...prev,
                                          [attenduKey]: !prev[attenduKey]
                                        }));
                                        if (!customAttendus[attenduKey]) {
                                          setCustomAttendus(prev => ({
                                            ...prev,
                                            [attenduKey]: resultatIndicatif
                                          }));
                                        }
                                      }}
                                      style={{ 
                                        width: '20px', 
                                        height: '20px', 
                                        marginTop: '2px',
                                        accentColor: '#f59e0b',
                                        cursor: 'pointer'
                                      }}
                                    />
                                    <div style={{ flex: 1 }}>
                                      {isSelected ? (
                                        <textarea
                                          value={customText || resultatIndicatif}
                                          onChange={(e) => setCustomAttendus(prev => ({
                                            ...prev,
                                            [attenduKey]: e.target.value
                                          }))}
                                          style={{
                                            width: '100%',
                                            minHeight: '60px',
                                            padding: '10px',
                                            background: 'rgba(30, 41, 59, 0.8)',
                                            border: hasCustom ? '1px solid rgba(16, 185, 129, 0.4)' : '1px solid rgba(245, 158, 11, 0.3)',
                                            borderRadius: '6px',
                                            color: '#e2e8f0',
                                            fontSize: '13px',
                                            resize: 'vertical',
                                            lineHeight: '1.5'
                                          }}
                                          placeholder="Personnaliser le texte de l'attendu..."
                                        />
                                      ) : (
                                        <span style={{ 
                                          color: '#cbd5e1', 
                                          fontSize: '13px',
                                          lineHeight: '1.5'
                                        }}>
                                          {resultatIndicatif}
                                        </span>
                                      )}
                                      {hasCustom && isSelected && (
                                        <div style={{
                                          marginTop: '6px',
                                          display: 'flex',
                                          alignItems: 'center',
                                          gap: '10px'
                                        }}>
                                          <span style={{ 
                                            color: '#10b981', 
                                            fontSize: '11px',
                                            background: 'rgba(16, 185, 129, 0.1)',
                                            padding: '3px 8px',
                                            borderRadius: '4px'
                                          }}>
                                            ✏️ Personnalisé
                                          </span>
                                          <button
                                            onClick={() => setCustomAttendus(prev => ({
                                              ...prev,
                                              [attenduKey]: resultatIndicatif
                                            }))}
                                            style={{
                                              background: 'transparent',
                                              border: 'none',
                                              color: '#94a3b8',
                                              fontSize: '11px',
                                              cursor: 'pointer',
                                              textDecoration: 'underline'
                                            }}
                                          >
                                            Réinitialiser
                                          </button>
                                        </div>
                                      )}
                                    </div>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        ))}
                    </div>
                  )}
                  
                  {/* Attendus personnalisés */}
                  {customOnDemande.length > 0 && (
                    <div style={{
                      background: 'rgba(16, 185, 129, 0.05)',
                      borderRadius: '12px',
                      padding: '16px',
                      marginBottom: '16px',
                      border: '1px solid rgba(16, 185, 129, 0.2)'
                    }}>
                      <div style={{ 
                        color: '#10b981', 
                        fontSize: '12px', 
                        marginBottom: '12px',
                        fontWeight: 600
                      }}>
                        ✨ Attendus personnalisés :
                      </div>
                      {customOnDemande.map((item) => (
                        <div key={item.id} style={{ 
                          marginBottom: '10px',
                          padding: '10px',
                          background: 'rgba(16, 185, 129, 0.1)',
                          borderRadius: '8px',
                          border: '1px solid rgba(16, 185, 129, 0.2)'
                        }}>
                          <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                            <input
                              type="checkbox"
                              checked={item.selected}
                              onChange={() => {
                                setCustomOnDemande(prev => prev.map(i => 
                                  i.id === item.id ? {...i, selected: !i.selected} : i
                                ));
                              }}
                              style={{ 
                                width: '20px', 
                                height: '20px', 
                                marginTop: '2px',
                                accentColor: '#10b981',
                                cursor: 'pointer'
                              }}
                            />
                            <input
                              type="text"
                              value={item.text}
                              onChange={(e) => {
                                setCustomOnDemande(prev => prev.map(i => 
                                  i.id === item.id ? {...i, text: e.target.value} : i
                                ));
                              }}
                              placeholder="Décrire l'attendu personnalisé (commencer par un verbe d'action)..."
                              style={{
                                flex: 1,
                                padding: '10px',
                                background: 'rgba(30, 41, 59, 0.8)',
                                border: '1px solid rgba(16, 185, 129, 0.3)',
                                borderRadius: '6px',
                                color: '#e2e8f0',
                                fontSize: '13px'
                              }}
                            />
                            <button
                              onClick={() => {
                                setCustomOnDemande(prev => prev.filter(i => i.id !== item.id));
                              }}
                              style={{
                                background: 'rgba(239, 68, 68, 0.2)',
                                border: '1px solid rgba(239, 68, 68, 0.3)',
                                borderRadius: '6px',
                                color: '#ef4444',
                                padding: '8px 12px',
                                cursor: 'pointer',
                                fontSize: '13px'
                              }}
                            >
                              ✕
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                  
                  {/* Bouton ajouter attendu personnalisé */}
                  <button
                    onClick={() => {
                      setCustomOnDemande(prev => [...prev, {
                        id: Date.now(),
                        text: '',
                        selected: true
                      }]);
                    }}
                    style={{
                      width: '100%',
                      padding: '12px',
                      marginBottom: '16px',
                      background: 'rgba(16, 185, 129, 0.1)',
                      border: '1px dashed rgba(16, 185, 129, 0.4)',
                      borderRadius: '8px',
                      color: '#10b981',
                      cursor: 'pointer',
                      fontSize: '13px',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '8px',
                      transition: 'all 0.2s ease'
                    }}
                  >
                    <span style={{ fontSize: '18px' }}>+</span> Ajouter un attendu personnalisé
                  </button>
                  
                  {/* Champ libre */}
                  <div>
                    <div style={{ 
                      color: '#94a3b8', 
                      fontSize: '12px', 
                      marginBottom: '8px',
                      fontStyle: 'italic'
                    }}>
                      📝 Remarques ou précisions supplémentaires (optionnel) :
                    </div>
                    <textarea
                      value={onDemande}
                      onChange={(e) => setOnDemande(e.target.value)}
                      placeholder="Notes complémentaires sur le travail demandé..."
                      style={{
                        width: '100%',
                        minHeight: '80px',
                        padding: '12px',
                        background: 'rgba(30, 41, 59, 0.8)',
                        border: '1px solid rgba(245, 158, 11, 0.3)',
                        borderRadius: '8px',
                        color: '#e2e8f0',
                        fontSize: '13px',
                        resize: 'vertical',
                        lineHeight: '1.5'
                      }}
                    />
                  </div>
                </div>

                {/* Logo du lycée et Connaissances globales */}
                <div style={{ 
                  display: 'grid', 
                  gridTemplateColumns: '1fr 1fr', 
                  gap: '24px',
                  marginBottom: '24px'
                }}>
                  {/* LOGO DU LYCÉE */}
                  <div>
                    <h4 style={{ 
                      color: '#06b6d4', 
                      fontSize: '14px', 
                      fontWeight: 600, 
                      marginBottom: '12px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <span>🏫</span> LOGO DU LYCÉE
                    </h4>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '16px',
                      padding: '16px',
                      background: 'rgba(30, 41, 59, 0.5)',
                      borderRadius: '8px',
                      border: '1px solid rgba(6, 182, 212, 0.3)'
                    }}>
                      <label style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        padding: '10px 16px',
                        background: 'rgba(6, 182, 212, 0.2)',
                        border: '1px solid rgba(6, 182, 212, 0.4)',
                        borderRadius: '6px',
                        color: '#06b6d4',
                        cursor: 'pointer',
                        fontSize: '13px',
                        fontWeight: 500
                      }}>
                        <span>📤</span> Télécharger
                        <input
                          type="file"
                          accept="image/*"
                          onChange={handleLogoUpload}
                          style={{ display: 'none' }}
                        />
                      </label>
                      {logoLycee && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                          <img 
                            src={logoLycee} 
                            alt="Logo Lycée" 
                            style={{ 
                              height: '50px', 
                              borderRadius: '4px',
                              border: '1px solid rgba(6, 182, 212, 0.3)'
                            }} 
                          />
                          <button
                            onClick={() => setLogoLycee(null)}
                            style={{
                              background: 'rgba(239, 68, 68, 0.2)',
                              border: '1px solid rgba(239, 68, 68, 0.3)',
                              borderRadius: '4px',
                              color: '#ef4444',
                              padding: '6px 10px',
                              cursor: 'pointer',
                              fontSize: '11px'
                            }}
                          >
                            ✕
                          </button>
                        </div>
                      )}
                      {!logoLycee && (
                        <span style={{ color: '#64748b', fontSize: '12px', fontStyle: 'italic' }}>
                          Aucun logo
                        </span>
                      )}
                    </div>
                  </div>

                  {/* CONNAISSANCES GLOBALES */}
                  <div>
                    <h4 style={{ 
                      color: '#4ade80', 
                      fontSize: '14px', 
                      fontWeight: 600, 
                      marginBottom: '12px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <span>📚</span> CONNAISSANCES GLOBALES
                    </h4>
                    <div style={{
                      background: 'rgba(30, 41, 59, 0.5)',
                      borderRadius: '8px',
                      padding: '12px',
                      maxHeight: '150px',
                      overflowY: 'auto'
                    }}>
                      {connaissancesGlobales.map(savoir => {
                        const isLinked = availableCompetences.some(comp => savoir.competences.includes(comp.id));
                        if (!isLinked) return null;
                        return (
                          <label 
                            key={savoir.id}
                            style={{ 
                              display: 'flex', 
                              alignItems: 'center', 
                              gap: '8px',
                              cursor: 'pointer',
                              padding: '6px 8px',
                              borderRadius: '4px',
                              background: selectedSavoirs[savoir.id] ? 'rgba(74, 222, 128, 0.15)' : 'transparent',
                              marginBottom: '4px'
                            }}
                          >
                            <input
                              type="checkbox"
                              checked={selectedSavoirs[savoir.id] || false}
                              onChange={() => setSelectedSavoirs(prev => ({
                                ...prev,
                                [savoir.id]: !prev[savoir.id]
                              }))}
                              style={{ 
                                width: '16px', 
                                height: '16px', 
                                accentColor: '#4ade80'
                              }}
                            />
                            <span style={{ 
                              color: '#4ade80', 
                              fontWeight: 600,
                              fontSize: '11px'
                            }}>
                              {savoir.id}.
                            </span>
                            <span style={{ 
                              color: '#e2e8f0', 
                              fontSize: '12px' 
                            }}>
                              {savoir.nom}
                            </span>
                          </label>
                        );
                      })}
                    </div>
                  </div>
                </div>

                {/* Bouton Export PDF */}
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'center',
                  paddingTop: '20px',
                  borderTop: '1px solid rgba(148, 163, 184, 0.2)'
                }}>
                  <button
                    onClick={exportToPDF}
                    style={{
                      background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                      border: 'none',
                      borderRadius: '12px',
                      color: 'white',
                      padding: '16px 40px',
                      cursor: 'pointer',
                      fontSize: '16px',
                      fontWeight: 600,
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      boxShadow: '0 4px 20px rgba(239, 68, 68, 0.3)',
                      transition: 'all 0.2s ease'
                    }}
                    onMouseOver={(e) => {
                      e.target.style.transform = 'translateY(-2px)';
                      e.target.style.boxShadow = '0 6px 25px rgba(239, 68, 68, 0.4)';
                    }}
                    onMouseOut={(e) => {
                      e.target.style.transform = 'translateY(0)';
                      e.target.style.boxShadow = '0 4px 20px rgba(239, 68, 68, 0.3)';
                    }}
                  >
                    <span style={{ fontSize: '20px' }}>📥</span>
                    Exporter en PDF
                  </button>
                </div>
              </div>
            )}
          </div>
        )}

        {/* Legend */}
        <div className="glass-card" style={{ 
          padding: '20px 32px', 
          marginTop: '24px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          gap: '24px',
          flexWrap: 'wrap'
        }}>
          <span style={{ fontSize: '12px', color: '#64748b', textTransform: 'uppercase', letterSpacing: '1px' }}>
            Niveaux taxonomiques :
          </span>
          {Object.entries(niveauLabels).map(([niveau, label]) => (
            <div key={niveau} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <span className={`tag niveau-${niveau}`} style={{ padding: '4px 8px', fontSize: '11px' }}>
                N{niveau}
              </span>
              <span style={{ fontSize: '12px', color: '#94a3b8' }}>{label}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<FormulaireBTSEBCR />);
    </script>
</body>
</html>
